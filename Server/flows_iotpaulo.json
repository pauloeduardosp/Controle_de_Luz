[{"id":"a76391e.e9c7d7","type":"tab","label":"Apartamento","disabled":false,"info":""},{"id":"f1b5c0e6.84dd68","type":"tab","label":"Flow 2","disabled":false,"info":""},{"id":"f91e3b4.e8602c8","type":"tab","label":"Status","disabled":false,"info":""},{"id":"9271b3dc.6bcd3","type":"tab","label":"Previsao","disabled":false,"info":""},{"id":"b5a5d7d1.da846","type":"tab","label":"teste","disabled":false,"info":""},{"id":"600c7542.809754","type":"tab","label":"teste_gradico","disabled":false,"info":""},{"id":"8f06c833.ed4578","type":"tab","label":"DashBoard","disabled":false,"info":""},{"id":"25167bbc.e1295c","type":"mqtt-broker","z":"","name":"localhost","broker":"localhost","port":"1883","clientid":"node-red","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"9e57a1d8.021468","type":"ui_group","z":"","name":"Quarto","tab":"510e1d1a.eac40c","order":1,"disp":false,"width":"4","collapse":false},{"id":"31779852.551a48","type":"ui_group","z":0,"name":"Status","tab":"aa3a149.d5ad168","order":4,"disp":true,"width":"4","collapse":false},{"id":"4c24412b.903b68","type":"ui_group","z":0,"name":"G1","tab":"aa3a149.d5ad168","order":1,"disp":false,"width":"4","collapse":false},{"id":"6825085.446fbf8","type":"ui_group","z":0,"name":"G2","tab":"aa3a149.d5ad168","order":2,"disp":false,"width":"4","collapse":false},{"id":"ac46c281.0280d","type":"ui_group","z":0,"name":"G3","tab":"aa3a149.d5ad168","order":3,"disp":false,"width":"4","collapse":false},{"id":"aabedb75.31173","type":"ui_group","z":0,"name":"Proto","tab":"510e1d1a.eac40c","order":4,"disp":true,"width":"4","collapse":false},{"id":"2d6291f0.c96026","type":"ui_group","z":0,"name":"Varanda","tab":"510e1d1a.eac40c","order":5,"disp":true,"width":"4","collapse":false},{"id":"569e3243.8d0fd4","type":"ui_group","z":"9271b3dc.6bcd3","name":"Default","tab":"","disp":true,"width":"6","collapse":false},{"id":"a095bd78.a8514","type":"ui_group","z":"","name":"Group 1","tab":"79127ce7.39f03c","order":2,"disp":false,"width":"6","collapse":false},{"id":"8e7b88aa.51306","type":"ui_group","z":"","name":"Clima","tab":"510e1d1a.eac40c","order":7,"disp":true,"width":"4","collapse":false},{"id":"510e1d1a.eac40c","type":"ui_tab","z":"","name":"Apartamento","icon":"dashboard","order":1,"disabled":false,"hidden":false},{"id":"aa3a149.d5ad168","type":"ui_tab","z":0,"name":"Status","icon":"dashboard","order":3},{"id":"d70fc1da.0bd0b8","type":"ui_tab","z":0,"name":"Gauge","icon":"dashboard","order":5},{"id":"79127ce7.39f03c","type":"ui_tab","z":0,"name":"Celular","icon":"dashboard","order":2},{"id":"64754fe7.eacce","type":"ui_base","z":0,"theme":{"name":"theme-dark","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#097479","value":"#097479","edited":false},"page-titlebar-backgroundColor":{"value":"#097479","edited":false},"page-backgroundColor":{"value":"#111111","edited":false},"page-sidebar-backgroundColor":{"value":"#000000","edited":false},"group-textColor":{"value":"#0eb8c0","edited":false},"group-borderColor":{"value":"#555555","edited":false},"group-backgroundColor":{"value":"#333333","edited":false},"widget-textColor":{"value":"#eeeeee","edited":false},"widget-backgroundColor":{"value":"#097479","edited":false},"widget-borderColor":{"value":"#333333","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"IotPaulo","hideToolbar":"false","allowSwipe":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"7ac0c575.b52f2c","type":"ui_group","z":"","name":"Sala","tab":"510e1d1a.eac40c","order":2,"disp":true,"width":"4","collapse":false},{"id":"e20140dd.dd5e1","type":"ui_spacer","name":"spacer","group":"6930de7c.33a158","order":2,"width":1,"height":1},{"id":"3ec61590.5f81b2","type":"ui_spacer","name":"spacer","group":"6930de7c.33a158","order":2,"width":1,"height":1},{"id":"59c31b1.a06a864","type":"ui_spacer","name":"spacer","group":"a095bd78.a8514","order":14,"width":"2","height":1},{"id":"158e6a96.4f7ac5","type":"ui_spacer","name":"spacer","group":"a095bd78.a8514","order":17,"width":"2","height":1},{"id":"59ecc737.ac68e8","type":"ui_spacer","name":"spacer","group":"a095bd78.a8514","order":11,"width":"2","height":1},{"id":"77a587fc.94b728","type":"ui_spacer","name":"spacer","group":"a095bd78.a8514","order":19,"width":1,"height":1},{"id":"9355bb6b.8ffdd","type":"ui_spacer","name":"spacer","group":"","order":1,"width":1,"height":1},{"id":"bd5a1d91.586a88","type":"ui_group","z":"","name":"Group 2","tab":"79127ce7.39f03c","order":1,"disp":true,"width":"6","collapse":false},{"id":"d4edc4d4.40c64","type":"ui_group","z":"","name":"Quarto M","tab":"510e1d1a.eac40c","order":3,"disp":true,"width":"4","collapse":false},{"id":"ef6bd426.64b96","type":"MySQLdatabase","z":"","name":"","host":"127.0.0.1","port":"3306","db":"iotpaulo","tz":"GMT-3"},{"id":"973f8824.f1529","type":"ui_tab","z":"","name":"Gauge2","icon":"dashboard","disabled":false,"hidden":false},{"id":"ed719681.9f24a8","type":"MySQLdatabase","z":"","host":"127.0.0.1","port":"3306","db":"nodered","tz":""},{"id":"ca50c56c.84f5e","type":"ui_spacer","name":"spacer","group":"f3e87151.7fbea","order":3,"width":6,"height":1},{"id":"c74036fc.d40768","type":"ui_spacer","name":"spacer","group":"","order":1,"width":1,"height":1},{"id":"e8af268b.39df78","type":"ui_group","z":"","name":"Group 1","tab":"973f8824.f1529","order":1,"disp":true,"width":"8","collapse":false},{"id":"8cb44b82.50baa8","type":"ui_spacer","name":"spacer","group":"e8af268b.39df78","order":3,"width":1,"height":1},{"id":"44d42465.f925bc","type":"ui_spacer","name":"spacer","group":"e8af268b.39df78","order":5,"width":8,"height":1},{"id":"77b74f37.61db78","type":"ui_spacer","name":"spacer","group":"e8af268b.39df78","order":7,"width":5,"height":1},{"id":"9e61c410.6a367","type":"ui_group","z":"","name":"Group","tab":"d70fc1da.0bd0b8","disp":false,"width":"10","collapse":false},{"id":"fa38ab22.8299c8","type":"ui_spacer","name":"spacer","group":"","order":4,"width":2,"height":1},{"id":"b003986c.cc623","type":"ui_spacer","name":"spacer","group":"","order":6,"width":4,"height":1},{"id":"835cd83f.f17f1","type":"ui_spacer","name":"spacer","group":"","order":7,"width":4,"height":1},{"id":"8bf60540.f67d4","type":"ui_spacer","name":"spacer","group":"","order":8,"width":2,"height":1},{"id":"2b2bb157.4fcc16","type":"ui_spacer","name":"spacer","group":"","order":9,"width":2,"height":1},{"id":"3ce4aa0a.19017e","type":"ui_spacer","name":"spacer","group":"","order":10,"width":4,"height":1},{"id":"406148e3.c9bb98","type":"ui_spacer","name":"spacer","group":"","order":11,"width":4,"height":1},{"id":"81a3f83e.513ab","type":"ui_spacer","name":"spacer","group":"","order":12,"width":2,"height":1},{"id":"d2309662.49308","type":"ui_spacer","name":"spacer","group":"","order":13,"width":2,"height":1},{"id":"1523c5d6.fb0b0a","type":"ui_spacer","name":"spacer","group":"","order":14,"width":4,"height":1},{"id":"942c49f5.ac974","type":"ui_spacer","name":"spacer","group":"","order":15,"width":4,"height":1},{"id":"8d6e625a.9a41b","type":"ui_spacer","name":"spacer","group":"","order":16,"width":2,"height":1},{"id":"d58f8346.3ba8d","type":"ui_tab","z":"","name":"Tab","icon":"dashboard","disabled":false,"hidden":false},{"id":"fa1c8cdb.a90c","type":"ui_group","z":"","name":"Default","tab":"d58f8346.3ba8d","disp":true,"width":4,"collapse":false},{"id":"3b010945.cc1f7e","type":"ui_spacer","name":"spacer","group":"","order":4,"width":3,"height":1},{"id":"153ba667.a2da42","type":"ui_spacer","name":"spacer","group":"","order":2,"width":8,"height":1},{"id":"7bcf4576.9604b4","type":"ui_spacer","name":"spacer","group":"","order":3,"width":8,"height":1},{"id":"2b404183.638db6","type":"ui_spacer","name":"spacer","group":"","order":4,"width":8,"height":1},{"id":"b6e67e0a.5994f8","type":"ui_spacer","name":"spacer","group":"9e57a1d8.021468","order":6,"width":4,"height":1},{"id":"9527332.5f9e45","type":"mqtt-broker","z":"","name":"","broker":"localhost","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"c534d984.0db6c","type":"ui_group","z":"","name":"Group 1","tab":"75f43944.a4ea98","disp":true,"width":"6","collapse":false},{"id":"efb8a5f4.4f3078","type":"ui_group","z":"","name":"Group 2","tab":"75f43944.a4ea98","disp":true,"width":"6","collapse":false},{"id":"6ad6e328.0f7754","type":"ui_group","z":"","name":"Group 3","tab":"75f43944.a4ea98","disp":true,"width":"6","collapse":false},{"id":"75f43944.a4ea98","type":"ui_tab","z":"","name":"Tab1","icon":"dashboard","disabled":false,"hidden":false},{"id":"a43ad091.5c553","type":"ui_group","z":"","name":"Group 1","tab":"9273068b.82c11","disp":true,"width":"6","collapse":false},{"id":"24600023.0c5ba8","type":"ui_group","z":"","name":"Group 2","tab":"9273068b.82c11","disp":true,"width":"6","collapse":false},{"id":"47de815b.b4866","type":"ui_group","z":"","name":"Group 3","tab":"9273068b.82c11","disp":true,"width":"6","collapse":false},{"id":"9273068b.82c11","type":"ui_tab","z":"","name":"Tab1","icon":"dashboard"},{"id":"eb11f64c.94c348","type":"ui_group","z":"","name":"Example Flow","tab":"b25518fa.09d048","disp":true,"width":"8","collapse":false},{"id":"b25518fa.09d048","type":"ui_tab","z":"","name":"Home","icon":"dashboard","disabled":false,"hidden":false},{"id":"1b42a45b.1ebb5c","type":"ui_group","z":"","name":"Default","tab":"4ec8f819.5342b8","disp":false,"width":"6","collapse":false},{"id":"4ec8f819.5342b8","type":"ui_tab","z":"","name":"Home","icon":"dashboard"},{"id":"5e52ce95.3eba58","type":"mqtt in","z":"a76391e.e9c7d7","name":"ape/quarto/luz","topic":"ape/quarto/luz","qos":"1","datatype":"auto","broker":"25167bbc.e1295c","x":173.97244262695312,"y":361.44451904296875,"wires":[["7fbfc46f.3dffec","132524ea.ce143b","1f0f4697.f059f9","63515e37.fc6008"]]},{"id":"f9699e28.21df48","type":"mqtt out","z":"a76391e.e9c7d7","name":"","topic":"","qos":"","retain":"","broker":"25167bbc.e1295c","x":950,"y":180,"wires":[]},{"id":"30a3e0b9.719d1","type":"change","z":"a76391e.e9c7d7","name":"","rules":[{"t":"change","p":"payload","pt":"msg","from":"disconnect","fromt":"str","to":"disconnect","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"on","fromt":"str","to":"Ligado","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"off","fromt":"str","to":"Desligado","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":640,"y":500,"wires":[["3d605702.17ad88","8b95da79.3073f8"]]},{"id":"c8a677e.4327508","type":"mqtt in","z":"a76391e.e9c7d7","name":"ape/quarto","topic":"ape/quarto","qos":"1","datatype":"auto","broker":"25167bbc.e1295c","x":146.02792358398438,"y":280.08343505859375,"wires":[["ae75103d.f0061","1f0f4697.f059f9"]]},{"id":"7fbfc46f.3dffec","type":"switch","z":"a76391e.e9c7d7","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"disconnect","vt":"str"},{"t":"neq","v":"disconnect","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":530,"y":440,"wires":[["3d605702.17ad88","8b95da79.3073f8"],["30a3e0b9.719d1"]]},{"id":"a7250b19.263cb","type":"comment","z":"a76391e.e9c7d7","name":"Alterar","info":"","x":182.30563354492188,"y":227.0833740234375,"wires":[]},{"id":"aa35ca26.8fc3f8","type":"json","z":"f91e3b4.e8602c8","name":"","property":"payload","action":"","pretty":false,"x":350,"y":380,"wires":[["190a3bfd.7ff84c","dfd54299.7b2ee","73a7ce58.e1f268","efaf8952.3b5058"]]},{"id":"16e97787.987ea","type":"switch","z":"f91e3b4.e8602c8","name":"","property":"payload.device","propertyType":"msg","rules":[{"t":"eq","v":"ape/quarto","vt":"str"},{"t":"eq","v":"ape/teste","vt":"str"},{"t":"eq","v":"ape/varanda","vt":"str"},{"t":"eq","v":"ape/corredor","vt":"str"},{"t":"eq","v":"ape/sala","vt":"str"},{"t":"eq","v":"ape/quartom","vt":"str"},{"t":"eq","v":"ape/quartom2","vt":"str"},{"t":"nnull"}],"checkall":"false","repair":false,"outputs":8,"x":770,"y":380,"wires":[["c6c618fb.817158"],["be4d59f3.aeba5"],["1cd8af6c.4d4021"],["5f06db6b.b1cbbc"],["e1975c02.0b463"],["e71ba605.c87c08"],["1eff0fc7.7cf26"],["1baa46f1.ad4aa1"]]},{"id":"82675091.afda68","type":"mqtt in","z":"f91e3b4.e8602c8","name":"","topic":"ape/status","qos":"2","datatype":"auto","broker":"25167bbc.e1295c","x":180,"y":380,"wires":[["2498db88.89c654","aa35ca26.8fc3f8"]]},{"id":"73a7ce58.e1f268","type":"function","z":"f91e3b4.e8602c8","name":"Send Disconect","func":"if (msg.payload.status === \"red\")\n{\n    msg.topic = msg.payload.device;\n    msg.enabled = false;\n    msg.payload = \"disconnect\"\n    return msg;\n}\n\n","outputs":1,"noerr":0,"x":580,"y":500,"wires":[["97d5153f.c88548"]]},{"id":"97d5153f.c88548","type":"mqtt out","z":"f91e3b4.e8602c8","name":"","topic":"","qos":"","retain":"","broker":"25167bbc.e1295c","x":770,"y":500,"wires":[]},{"id":"f43b0012.92d29","type":"mqtt in","z":"a76391e.e9c7d7","name":"","topic":"ape/varanda/luz","qos":"1","datatype":"auto","broker":"25167bbc.e1295c","x":260,"y":1360,"wires":[["31b40c18.dda714","f5e750fa.b8cc9","44f6f8b2.c19c78"]]},{"id":"aa42fc6f.a15d98","type":"mqtt out","z":"a76391e.e9c7d7","name":"","topic":"","qos":"","retain":"","broker":"25167bbc.e1295c","x":910,"y":1280,"wires":[]},{"id":"bee9f782.bd1d38","type":"change","z":"a76391e.e9c7d7","name":"","rules":[{"t":"change","p":"payload","pt":"msg","from":"on","fromt":"str","to":"Ligado","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"off","fromt":"str","to":"Desligado","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"disconnect","fromt":"str","to":"Disconectado","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":667.6983947753906,"y":1481.3053894042969,"wires":[["7062d76a.426fd","5a59efe3.cc82e"]]},{"id":"d5702303.9399f8","type":"mqtt in","z":"a76391e.e9c7d7","name":"","topic":"ape/varanda","qos":"1","datatype":"auto","broker":"25167bbc.e1295c","x":261.0554656982422,"y":1296.6389465332031,"wires":[["ee0b30ee.7e237","44f6f8b2.c19c78"]]},{"id":"4841f3b3.4fa0ec","type":"comment","z":"a76391e.e9c7d7","name":"Alterar group","info":"Alterar group dashboard\n","x":815.5832824707031,"y":1402.9446716308594,"wires":[]},{"id":"46f931e0.be6858","type":"comment","z":"a76391e.e9c7d7","name":"Alterar topic","info":"locationid/deviceid/mqttAtuadorId/change\n\nape/teste/luz1/change","x":655.0776672363281,"y":1267.6167602539062,"wires":[]},{"id":"a6e87f8f.0748d","type":"comment","z":"a76391e.e9c7d7","name":"Alterar topic","info":"locationid/deviceid\nape/teste\n\nlocationid/deviceid/mqttAtuadorId\nape/teste/luz1","x":259.2999267578125,"y":1262.061279296875,"wires":[]},{"id":"31b40c18.dda714","type":"switch","z":"a76391e.e9c7d7","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"disconnect","vt":"str"},{"t":"neq","v":"disconnect","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":530,"y":1420,"wires":[["7062d76a.426fd","5a59efe3.cc82e"],["bee9f782.bd1d38"]]},{"id":"3ca32653.1df1ba","type":"inject","z":"9271b3dc.6bcd3","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"3600","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":310,"y":760,"wires":[["53ac6cbb.8a315c"]]},{"id":"53ac6cbb.8a315c","type":"function","z":"9271b3dc.6bcd3","name":"","func":"msg.payload = new Date().toLocaleTimeString();\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":490,"y":760,"wires":[["3ec90217.280fee","d0aba60d.fae9c8"]]},{"id":"25bc9c5c.160764","type":"inject","z":"9271b3dc.6bcd3","name":"","repeat":"420","crontab":"","once":true,"onceDelay":"","topic":"","payload":"","payloadType":"date","x":210,"y":240,"wires":[["25306ea8.86cf0a"]]},{"id":"25306ea8.86cf0a","type":"http request","z":"9271b3dc.6bcd3","name":"GET ClimaTempo Atual","method":"GET","ret":"obj","paytoqs":false,"url":"http://apiadvisor.climatempo.com.br/api/v1/weather/locale/3477/current?token=6437f1eb0ce7916ac9dcf5338023d66d","tls":"","proxy":"","authType":"","x":430,"y":240,"wires":[["e0fa477f.2340d","dd0aafdf.6aee98","46f08fa2.4ad9c"]]},{"id":"132524ea.ce143b","type":"debug","z":"a76391e.e9c7d7","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":270,"y":420,"wires":[]},{"id":"ae75103d.f0061","type":"debug","z":"a76391e.e9c7d7","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":353.20001220703125,"y":199.1999969482422,"wires":[]},{"id":"f5e750fa.b8cc9","type":"debug","z":"a76391e.e9c7d7","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":423.9221954345703,"y":1481.9444427490234,"wires":[]},{"id":"ee0b30ee.7e237","type":"debug","z":"a76391e.e9c7d7","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":437.6222229003906,"y":1258.344482421875,"wires":[]},{"id":"2498db88.89c654","type":"debug","z":"f91e3b4.e8602c8","name":"Status_json","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":290,"y":480,"wires":[]},{"id":"a9b1853d.93054","type":"mqtt in","z":"a76391e.e9c7d7","name":"","topic":"ape/quarto/dht","qos":"1","broker":"25167bbc.e1295c","x":246.9222412109375,"y":2222.64453125,"wires":[["8d290780.deb0d","cd91ad37.f037b8"]]},{"id":"8d290780.deb0d","type":"json","z":"a76391e.e9c7d7","name":"","property":"payload","action":"","pretty":false,"x":464.8055725097656,"y":2226.5277709960938,"wires":[["241546a2.b8fea2","68726097.2191b"]]},{"id":"241546a2.b8fea2","type":"function","z":"a76391e.e9c7d7","name":"","func":"var topico = \"quarto\"     // editar para outro comodo - usado para o grafico\n\nvar msgU;\nvar msgT;\nvar dateNow = new Date();\n msg.enabled = false;\nif(msg.payload === \"input\") {\n\n    dif_date = (dateNow - context.get('c_time'))/1000/60\n\n\n    if(dif_date >= 6.20){\n\n        msgU = { payload: '-', topic: topico};\n        msgT = { payload: '-', topic: topico};\n    }\n    \n} else {\n\n\nu = msg.payload.u\n    if(msg.payload.u === \"0.00\" && msg.payload.t === \"0.00\"){\n        msgU = { payload: '-', topic: topico};\n        msgT = { payload: '-', topic: topico};\n    } else {\n        msgU = { payload: msg.payload.u, topic: topico};\n        msgT = { payload: msg.payload.t, topic: topico};\n    }\n    context.set(\"c_time\", dateNow)\n\n}\n\nreturn [msgU, msgT]\n","outputs":2,"noerr":0,"x":646.8055419921875,"y":2233.5277709960938,"wires":[["cf1c4267.3321c"],["2da905d5.7071da","33ab044a.aa5b44"]]},{"id":"a8f3368d.3449b8","type":"comment","z":"a76391e.e9c7d7","name":"View Celular","info":"locationid/deviceid/mqttAtuadorId/change\n\nape/teste/luz1/change","x":627.3055419921875,"y":755.6278533935547,"wires":[]},{"id":"921db7ed.32fff","type":"comment","z":"a76391e.e9c7d7","name":"View Celular","info":"locationid/deviceid/mqttAtuadorId/change\n\nape/teste/luz1/change","x":908.3055114746094,"y":1474.8278503417969,"wires":[]},{"id":"28b77a88.6c658e","type":"comment","z":"a76391e.e9c7d7","name":"View Celular","info":"locationid/deviceid/mqttAtuadorId/change\n\nape/teste/luz1/change","x":1044.4222412109375,"y":2250.14453125,"wires":[]},{"id":"a32d997.5e89868","type":"comment","z":"a76391e.e9c7d7","name":"View Celular","info":"locationid/deviceid/mqttAtuadorId/change\n\nape/teste/luz1/change","x":711.1053466796875,"y":44.033294677734375,"wires":[]},{"id":"c860bc31.4d1568","type":"comment","z":"a76391e.e9c7d7","name":"View Celular","info":"locationid/deviceid/mqttAtuadorId/change\n\nape/teste/luz1/change","x":930,"y":460,"wires":[]},{"id":"c4cfd31d.4d3488","type":"mqtt in","z":"a76391e.e9c7d7","name":"","topic":"ape/teste/luz","qos":"1","datatype":"auto","broker":"25167bbc.e1295c","x":160.83334350585938,"y":937.4834594726562,"wires":[["71b5dfad.cc9e78","f225fb58.fe5d58","177dd60.1314e2a"]]},{"id":"55b8d1fa.d7198","type":"mqtt out","z":"a76391e.e9c7d7","name":"","topic":"","qos":"","retain":"","broker":"25167bbc.e1295c","x":800.0830078125,"y":884.9557495117188,"wires":[]},{"id":"54130ac9.545fac","type":"mqtt in","z":"a76391e.e9c7d7","name":"","topic":"ape/teste","qos":"1","datatype":"auto","broker":"25167bbc.e1295c","x":157.8887939453125,"y":874.122314453125,"wires":[["7cfdd428.8149b4","f225fb58.fe5d58"]]},{"id":"d356339a.10e71","type":"comment","z":"a76391e.e9c7d7","name":"Alterar group","info":"Alterar group dashboard\n","x":749.4166259765625,"y":957.4281005859375,"wires":[]},{"id":"e35080b1.5860d8","type":"comment","z":"a76391e.e9c7d7","name":"Alterar topic","info":"locationid/deviceid/mqttAtuadorId/change\n\nape/teste/luz1/change","x":645.9110107421875,"y":850.1001586914062,"wires":[]},{"id":"cad6ca89.d6133","type":"comment","z":"a76391e.e9c7d7","name":"Alterar topic","info":"locationid/deviceid\nape/teste\n\nlocationid/deviceid/mqttAtuadorId\nape/teste/luz1","x":234.1576690673828,"y":817.9381713867188,"wires":[]},{"id":"71b5dfad.cc9e78","type":"debug","z":"a76391e.e9c7d7","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":344.4222412109375,"y":1077.14453125,"wires":[]},{"id":"8a9f9a4e.f772d","type":"comment","z":"a76391e.e9c7d7","name":"View Celular","info":"locationid/deviceid/mqttAtuadorId/change\n\nape/teste/luz1/change","x":704.3055419921875,"y":1035.8278198242188,"wires":[]},{"id":"39a1ed51.1a53b2","type":"comment","z":"a76391e.e9c7d7","name":"View Celular","info":"locationid/deviceid/mqttAtuadorId/change\n\nape/teste/luz1/change","x":651.3055114746094,"y":1198.2278747558594,"wires":[]},{"id":"5650bfb2.1d3288","type":"comment","z":"a76391e.e9c7d7","name":"Alterar topic","info":"locationid/deviceid/mqttAtuadorId/change\n\nape/teste/luz1/change","x":735.1053466796875,"y":137.63330078125,"wires":[]},{"id":"226413ae.9c2f6c","type":"http request","z":"b5a5d7d1.da846","name":"Post to Pushover","method":"POST","ret":"txt","url":"https://api.pushover.net/1/messages.json","tls":"","x":595.88330078125,"y":89.88334655761719,"wires":[[]]},{"id":"1b58c71.2b18ab9","type":"function","z":"b5a5d7d1.da846","name":"","func":"msg.headers = {\n    \"content-type\": \"application/x-www-form-urlencoded\"\n};\nmsg.payload = { \n    user: 'USERKEYHERE',\n    token: 'ApplicationKeyHere',\n    message: 'MESSAGE HERE',\n    title: 'TITLE HERE',\n    priority: '-1'\n};\nreturn msg;","outputs":1,"noerr":0,"x":401.88323974609375,"y":89.54998779296875,"wires":[["226413ae.9c2f6c"]]},{"id":"99148640.dd6878","type":"http request","z":"b5a5d7d1.da846","name":"Post to Pushover","method":"POST","ret":"txt","url":"https://api.pushover.net/1/messages.json","tls":"","x":587.88330078125,"y":163.8833465576172,"wires":[[]]},{"id":"93b41206.817138","type":"function","z":"b5a5d7d1.da846","name":"","func":"msg.headers = {\n    \"content-type\": \"application/x-www-form-urlencoded\"\n};\nmsg.payload = { \n    user: 'USERKEYHERE',\n    token: 'ApplicationKeyHere',\n    message: 'MESSAGE HERE',\n    title: 'TITLE HERE',\n    priority: '-1'\n};\nreturn msg;","outputs":1,"noerr":0,"x":393.88323974609375,"y":163.54998779296875,"wires":[["99148640.dd6878"]]},{"id":"b33427bb.996048","type":"inject","z":"b5a5d7d1.da846","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"teste pushover","payloadType":"str","x":234.76666259765625,"y":375.5666961669922,"wires":[["8e9e9501.a071e"]]},{"id":"fc1d6ceb.e75ca","type":"ui_button","z":"a76391e.e9c7d7","name":"","group":"9e57a1d8.021468","order":2,"width":2,"height":1,"passthru":false,"label":"Luz","tooltip":"","color":"","bgcolor":"","icon":"wb_incandescent","payload":"change","payloadType":"str","topic":"ape/quarto/luz/change","x":730.4444580078125,"y":183.47225952148438,"wires":[["f9699e28.21df48"]]},{"id":"d8a3edb3.7d80d8","type":"ui_button","z":"a76391e.e9c7d7","name":"","group":"2d6291f0.c96026","order":1,"width":2,"height":1,"passthru":false,"label":"Luz","tooltip":"","color":"","bgcolor":"","icon":"wb_incandescent","payload":"change","payloadType":"str","topic":"ape/varanda/luz/change","x":670,"y":1300,"wires":[["aa42fc6f.a15d98"]]},{"id":"e82d48e7.dce51","type":"ui_button","z":"a76391e.e9c7d7","name":"","group":"a095bd78.a8514","order":9,"width":"2","height":"1","passthru":false,"label":"Varanda","tooltip":"","color":"","bgcolor":"","icon":"wb_incandescent","payload":"change","payloadType":"str","topic":"ape/varanda/luz/change","x":668.3055114746094,"y":1234.2278442382812,"wires":[["aa42fc6f.a15d98"]]},{"id":"c2898b7e.605468","type":"ui_button","z":"a76391e.e9c7d7","name":"","group":"a095bd78.a8514","order":1,"width":"2","height":"1","passthru":false,"label":"Quarto","tooltip":"","color":"","bgcolor":"","icon":"wb_incandescent","payload":"change","payloadType":"str","topic":"ape/quarto/luz/change","x":715.1053466796875,"y":86.63330078125,"wires":[["f9699e28.21df48"]]},{"id":"b62a2579.b3a798","type":"ui_button","z":"a76391e.e9c7d7","name":"","group":"aabedb75.31173","order":1,"width":2,"height":1,"passthru":false,"label":"Luz","tooltip":"","color":"","bgcolor":"","icon":"wb_incandescent","payload":"change","payloadType":"str","topic":"ape/teste/luz/change","x":640.3055419921875,"y":884.4278564453125,"wires":[["55b8d1fa.d7198"]]},{"id":"519af793.6248c","type":"ui_button","z":"a76391e.e9c7d7","name":"","group":"a095bd78.a8514","order":6,"width":"2","height":"1","passthru":false,"label":"Proto","tooltip":"","color":"","bgcolor":"","icon":"wb_incandescent","payload":"change","payloadType":"str","topic":"ape/teste/luz/change","x":637.3055419921875,"y":790.4278411865234,"wires":[["55b8d1fa.d7198"]]},{"id":"3d605702.17ad88","type":"ui_text","z":"a76391e.e9c7d7","group":"9e57a1d8.021468","order":3,"width":2,"height":1,"name":"","label":"","format":"{{msg.payload}}","layout":"row-center","x":810,"y":440,"wires":[]},{"id":"7062d76a.426fd","type":"ui_text","z":"a76391e.e9c7d7","group":"2d6291f0.c96026","order":2,"width":2,"height":1,"name":"","label":"","format":"{{msg.payload}}","layout":"row-center","x":817.3055725097656,"y":1435.2218933105469,"wires":[]},{"id":"3ec90217.280fee","type":"ui_text","z":"9271b3dc.6bcd3","group":"fa1c8cdb.a90c","order":1,"width":0,"height":0,"name":"","label":"Time","format":"{{msg.payload}}","layout":"row-spread","x":630,"y":760,"wires":[]},{"id":"cf1c4267.3321c","type":"ui_text","z":"a76391e.e9c7d7","group":"9e57a1d8.021468","order":5,"width":2,"height":1,"name":"","label":"Umidade","format":"{{msg.payload | number:1}} %","layout":"col-center","x":894.4222412109375,"y":2237.14453125,"wires":[]},{"id":"2da905d5.7071da","type":"ui_text","z":"a76391e.e9c7d7","group":"9e57a1d8.021468","order":4,"width":2,"height":1,"name":"","label":"Temperatura","format":"{{msg.payload | number:1}} °C ","layout":"col-center","x":904.4222412109375,"y":2317.14453125,"wires":[]},{"id":"5a59efe3.cc82e","type":"ui_text","z":"a76391e.e9c7d7","group":"a095bd78.a8514","order":10,"width":"2","height":"1","name":"","label":"","format":"{{msg.payload}}","layout":"row-center","x":909.3055114746094,"y":1508.2278442382812,"wires":[]},{"id":"33ab044a.aa5b44","type":"ui_text","z":"a76391e.e9c7d7","group":"a095bd78.a8514","order":5,"width":"2","height":"1","name":"","label":"Temperatura","format":"{{msg.payload | number:1}} °C ","layout":"col-center","x":1044.4222412109375,"y":2277.14453125,"wires":[]},{"id":"8b95da79.3073f8","type":"ui_text","z":"a76391e.e9c7d7","group":"a095bd78.a8514","order":2,"width":"2","height":"1","name":"","label":"","format":"{{msg.payload}}","layout":"row-center","x":850,"y":500,"wires":[]},{"id":"b77d1915.afe938","type":"ui_text","z":"a76391e.e9c7d7","group":"aabedb75.31173","order":2,"width":2,"height":1,"name":"","label":"","format":"{{msg.payload}}","layout":"row-center","x":767.138916015625,"y":992.705322265625,"wires":[]},{"id":"743fed93.2e56cc","type":"ui_text","z":"a76391e.e9c7d7","group":"a095bd78.a8514","order":7,"width":"2","height":"1","name":"","label":"","format":"{{msg.payload}}","layout":"row-center","x":711.3055419921875,"y":1070.4278564453125,"wires":[]},{"id":"be4d59f3.aeba5","type":"ui_template","z":"f91e3b4.e8602c8","group":"6825085.446fbf8","name":"ape/teste","order":1,"width":4,"height":4,"format":"<svg width=\"180\" height=\"35\">\n    \n    <circle id=\"circle1\" cx=\"20\" cy=\"20\" r=\"10\"\n            style=\"stroke: none; fill: {{msg.payload.status}}\"/>\n    <text font-size=\"18px\" font-weight=\"bold\" \n            x=\"48\" y=\"25\"  fill=\"white\">{{msg.payload.device}}</text>\n</svg>\n\n\n<table width=180px>\n\n  <tr>\n    <td>IP</td>\n    <td align=\"right\"><B>{{msg.payload.ip}}</B></td>\n  </tr>\n  <tr>\n    <td>UpTime</td>\n    <td align=\"right\"><B>{{msg.payload.up}}</B></td>\n  </tr>\n  <tr>\n    <td>Reset</td>\n    <td align=\"right\"><B>{{msg.payload.reset}}</B></td>\n  </tr>\n  <tr>\n    <td>Versao</td>\n    <td align=\"right\"><B>{{msg.payload.ver}}</B></td>\n  </tr>\n  <tr>\n    <td>UpDate</td>\n    <td align=\"right\"><B>{{msg.payload.date | date:'dd/MM - HH:mm'}}</B></td>\n  </tr>\n</table>\n\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1160,"y":280,"wires":[["24a62797.64e208"]]},{"id":"c6c618fb.817158","type":"ui_template","z":"f91e3b4.e8602c8","group":"4c24412b.903b68","name":"ape/quarto","order":1,"width":4,"height":4,"format":"<svg width=\"180\" height=\"35\">\n    \n    <circle id=\"circle1\" cx=\"20\" cy=\"20\" r=\"10\"\n            style=\"stroke: none; fill: {{msg.payload.status}}\"/>\n    <text font-size=\"18px\" font-weight=\"bold\" \n            x=\"48\" y=\"25\"  fill=\"white\">{{msg.payload.device}}</text>\n</svg>\n<table width=180px>\n\n  <tr>\n    <td>IP</td>\n    <td align=\"right\"><B>{{msg.payload.ip}}</B></td>\n  </tr>\n  <tr>\n    <td>UpTime</td>\n    <td align=\"right\"><B>{{msg.payload.up}}</B></td>\n  </tr>\n  <tr>\n    <td>Reset</td>\n    <td align=\"right\"><B>{{msg.payload.reset}}</B></td>\n  </tr>\n    <tr>\n    <td>Versao</td>\n    <td align=\"right\"><B>{{msg.payload.ver}}</B></td>\n  </tr>\n  <tr>\n    <td>UpDate</td>\n    <td align=\"right\"><B>{{msg.payload.date | date:'dd/MM - HH:mm'}}</B></td>\n  </tr>\n</table>\n\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1070,"y":160,"wires":[[]]},{"id":"1cd8af6c.4d4021","type":"ui_template","z":"f91e3b4.e8602c8","group":"ac46c281.0280d","name":"Ape/Varanda","order":1,"width":4,"height":4,"format":"<svg width=\"180\" height=\"35\">\n    \n    <circle id=\"circle1\" cx=\"20\" cy=\"20\" r=\"10\"\n            style=\"stroke: none; fill: {{msg.payload.status}}\"/>\n    <text font-size=\"18px\" font-weight=\"bold\" \n            x=\"48\" y=\"25\"  fill=\"white\">{{msg.payload.device}}</text>\n</svg>\n<table width=180px>\n\n  <tr>\n    <td>IP</td>\n     <td align=\"right\"><B>{{msg.payload.ip}}</B></td>\n  </tr>\n  <tr>\n    <td>UpTime</td>\n    <td align=\"right\"><B>{{msg.payload.up}}</B></td>\n  </tr>\n  <tr>\n    <td>Reset</td>\n    <td align=\"right\"><B>{{msg.payload.reset}}</B></td>\n  </tr>\n    <tr>\n    <td>Versao</td>\n    <td align=\"right\"><B>{{msg.payload.ver}}</B></td>\n  </tr>\n  <tr>\n    <td>UpDate</td>\n    <td align=\"right\"><B>{{msg.payload.date | date:'dd/MM - HH:mm'}}</B></td>\n  </tr>\n</table>\n\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1070,"y":360,"wires":[[]]},{"id":"8e9e9501.a071e","type":"pushover","z":"b5a5d7d1.da846","name":"nome","device":"","title":"teste","priority":0,"sound":"","url":"url","url_title":"url title","html":false,"x":467.2666320800781,"y":374.30006408691406,"wires":[]},{"id":"7cfdd428.8149b4","type":"debug","z":"a76391e.e9c7d7","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":422.4222412109375,"y":812.14453125,"wires":[]},{"id":"dfd54299.7b2ee","type":"function","z":"f91e3b4.e8602c8","name":"Salva_variaveis","func":"/* salva os status de ip e versao da msg para replicar na desconexão */\n\nmsg.payload.date = new Date() //substituindo o insert timestamp, \n\nvar count = context.get('f_count')||0;\nvar count1 = count\nvar device_id_num = \"NOK\"\n\n\nfor (var x = 0; x <= count; x++){\n    if(count === 0){\n        context.set(\"f_device[\"+x+\"]\" ,msg.payload.device)\n        count++\n        context.set(\"f_count\", count)\n        device_id_num = x\n        break; \n    }\n\n    if (context.get(\"f_device[\"+x+\"]\") === msg.payload.device){\n        device_id_num = x\n        break; \n    }\n}\n\nif(msg.payload.status === \"green\"){\n    if(device_id_num === \"NOK\"){\n        context.set(\"f_device[\"+count+\"]\",msg.payload.device)\n        count++\n        context.set(\"f_count\", count)\n        context.set(\"f_versao[\"+count+\"]\",msg.payload.ver)\n        context.set(\"f_ip[\"+count+\"]\",msg.payload.ip)\n    } else {\n        context.set(\"f_versao[\"+device_id_num+\"]\",msg.payload.ver)\n        context.set(\"f_ip[\"+device_id_num+\"]\",msg.payload.ip)\n    }\n} else {\n    msg.payload.ver = context.get(\"f_versao[\"+device_id_num+\"]\")\n    msg.payload.ip = context.get(\"f_ip[\"+device_id_num+\"]\")\n}\n\n\nreturn msg\n","outputs":1,"noerr":0,"x":560,"y":380,"wires":[["16e97787.987ea","36aa6a60.c3a55e"]]},{"id":"cd91ad37.f037b8","type":"debug","z":"a76391e.e9c7d7","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":324.4222412109375,"y":2297.14453125,"wires":[]},{"id":"e18ee662.91e23","type":"inject","z":"a76391e.e9c7d7","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"u\":\"62.00\",\"t\":\"27.60\"}","payloadType":"str","x":231.4222412109375,"y":2118.64453125,"wires":[["8d290780.deb0d"]]},{"id":"1324885e.ebb188","type":"comment","z":"a76391e.e9c7d7","name":"Alterar topico","info":"Alterar variavel topico\n","x":644.9222412109375,"y":2197.64453125,"wires":[]},{"id":"532cb6e9.e8063","type":"inject","z":"a76391e.e9c7d7","name":"input 5 min","repeat":"300","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"input","payloadType":"str","x":141,"y":59,"wires":[["753e508a.6a4198"]]},{"id":"753e508a.6a4198","type":"link out","z":"a76391e.e9c7d7","name":"input 5 min","links":["3068bc62.c6716c","7e9d680b.6bb33","c5d6c6c6.30f91","ef7935ef.06f7","d2df8a81.a5a66","ae2cf4c6.a5923","36874adc.5a24ae","58ab0908.8d5c9","244634f4.1de8fc","a19edd40.647b2","b250170.60cfb68","f0dd5d15.9f4f18","22330821.1356d8","6da78554.5e2684"],"x":310,"y":60,"wires":[],"l":true},{"id":"3068bc62.c6716c","type":"link in","z":"a76391e.e9c7d7","name":"input 5 min","links":["753e508a.6a4198"],"x":231.1722412109375,"y":744.89453125,"wires":[[]],"l":true,"info":"5 min\n"},{"id":"7e9d680b.6bb33","type":"link in","z":"a76391e.e9c7d7","name":"input 5 min","links":["753e508a.6a4198"],"x":249.1722412109375,"y":1205.89453125,"wires":[["44f6f8b2.c19c78"]],"l":true,"info":"5 min\n"},{"id":"c5d6c6c6.30f91","type":"link in","z":"a76391e.e9c7d7","name":"input 5 min","links":["753e508a.6a4198"],"x":475.6722412109375,"y":2164.39453125,"wires":[["241546a2.b8fea2"]],"l":true,"info":"5 min\n"},{"id":"f225fb58.fe5d58","type":"function","z":"a76391e.e9c7d7","name":"Enable/Disable new","func":"var msg1 = msg\nvar msg2\nvar dateNow = new Date();\nenvia_pushover = context.get('c_envia_pushover')\nvar old_time = context.get('c_time') || 0\n\nif(msg.payload === \"input\") {\n\n    dif_date = (dateNow - old_time)/1000/60\n    if(context.get('c_envia_pushover') === \"sim\"){\n        if(dif_date >= 6.20){\n            msg2 = { payload:\"disconected\"};\n            context.set(\"c_envia_pushover\", \"não\")\n        }\n    }\n\n    return [null, msg2]\n    \n} else {\n\n    if(msg.payload === \"on\"){\n        msg.payload = \"Ligado\"\n        msg.enabled = true\n    } else {\n        if(msg.payload === \"off\"){\n            msg.payload = \"Desligado\"\n            msg.enabled = true\n        } else {\n            if(msg.payload === \"disconnect\"){\n                msg.payload = \"Disconectado\"\n                msg.enabled = false\n                context.set(\"c_time\", dateNow)\n                context.set(\"c_envia_pushover\", \"sim\")\n            }\n            \n        }\n    }\n}\n\nreturn [msg1, null]\n\n","outputs":2,"noerr":0,"x":420,"y":900,"wires":[["519af793.6248c","b77d1915.afe938","743fed93.2e56cc","b62a2579.b3a798"],[]]},{"id":"1f0f4697.f059f9","type":"function","z":"a76391e.e9c7d7","name":"Enable/Disable new","func":"var msg1 = msg\nvar msg2\nvar dateNow = new Date();\nenvia_pushover = context.get('c_envia_pushover')\nvar old_time = context.get('c_time') || 0\n\nif(msg.payload === \"input\") {\n\n    dif_date = (dateNow - old_time)/1000/60\n    if(context.get('c_envia_pushover') === \"sim\"){\n        if(dif_date >= 6.20){\n            msg2 = { payload:\"disconected\"};\n            context.set(\"c_envia_pushover\", \"não\")\n        }\n    }\n\n    return [null, msg2]\n    \n} else {\n\n    if(msg.payload === \"on\"){\n        msg.payload = \"Ligado\"\n        msg.enabled = true\n    } else {\n        if(msg.payload === \"off\"){\n            msg.payload = \"Desligado\"\n            msg.enabled = true\n        } else {\n            if(msg.payload === \"disconnect\"){\n                msg.payload = \"Disconectado\"\n                msg.enabled = false\n                context.set(\"c_time\", dateNow)\n                context.set(\"c_envia_pushover\", \"sim\")\n            }\n            \n        }\n    }\n}\n\nreturn [msg1, null]\n\n","outputs":2,"noerr":0,"x":409.75,"y":285.75,"wires":[["c2898b7e.605468","fc1d6ceb.e75ca","3d605702.17ad88","8b95da79.3073f8"],[]]},{"id":"ef7935ef.06f7","type":"link in","z":"a76391e.e9c7d7","name":"input 5 min","links":["753e508a.6a4198"],"x":143.75,"y":183.75,"wires":[["1f0f4697.f059f9"]],"l":true,"info":"5 min\n"},{"id":"e156b5f5.5b435","type":"comment","z":"a76391e.e9c7d7","name":"Alterar group","info":"Alterar group dashboard\n","x":790,"y":400,"wires":[]},{"id":"8022df77.b7ead8","type":"mqtt in","z":"a76391e.e9c7d7","name":"ape/corredor/luz","topic":"ape/corredor/luz","qos":"1","datatype":"auto","broker":"25167bbc.e1295c","x":180,"y":2960,"wires":[["9ec6d3db.a5e508","809d4a29.ab71d"]]},{"id":"118b70a3.2dcd87","type":"mqtt out","z":"a76391e.e9c7d7","name":"","topic":"","qos":"","retain":"","broker":"25167bbc.e1295c","x":1115.8055114746094,"y":2925.8055114746094,"wires":[]},{"id":"d558108f.117978","type":"mqtt in","z":"a76391e.e9c7d7","name":"ape/corredor","topic":"ape/corredor","qos":"1","datatype":"auto","broker":"25167bbc.e1295c","x":258.05548095703125,"y":2875.638916015625,"wires":[["809d4a29.ab71d","b4f96446.cb08c8"]]},{"id":"144aff4c.6f9b41","type":"comment","z":"a76391e.e9c7d7","name":"Alterar","info":"","x":258.33319091796875,"y":2825.6388549804688,"wires":[]},{"id":"4a086819.16b65","type":"debug","z":"a76391e.e9c7d7","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":650,"y":2820,"wires":[]},{"id":"adacd552.186c6","type":"comment","z":"a76391e.e9c7d7","name":"View Celular","info":"locationid/deviceid/mqttAtuadorId/change\n\nape/teste/luz1/change","x":876.9108581542969,"y":2789.8388061523438,"wires":[]},{"id":"56e6d437.0d0b2c","type":"comment","z":"a76391e.e9c7d7","name":"View Celular","info":"locationid/deviceid/mqttAtuadorId/change\n\nape/teste/luz1/change","x":957.910888671875,"y":3065.8389282226562,"wires":[]},{"id":"5099cc8a.e6e454","type":"comment","z":"a76391e.e9c7d7","name":"Alterar topic","info":"locationid/deviceid/mqttAtuadorId/change\n\nape/teste/luz1/change","x":900.9108581542969,"y":2883.4388122558594,"wires":[]},{"id":"4055354d.13ba1c","type":"ui_button","z":"a76391e.e9c7d7","name":"","group":"7ac0c575.b52f2c","order":5,"width":2,"height":1,"passthru":false,"label":"Corredor","tooltip":"","color":"","bgcolor":"","icon":"wb_incandescent","payload":"change","payloadType":"str","topic":"ape/corredor/luz/change","x":908.2499694824219,"y":2924.2777709960938,"wires":[["118b70a3.2dcd87","1a9d808.a22308"]]},{"id":"2d01e2e5.e0f3ae","type":"ui_button","z":"a76391e.e9c7d7","name":"","group":"a095bd78.a8514","order":12,"width":"2","height":"1","passthru":false,"label":"Corredor","tooltip":"","color":"","bgcolor":"","icon":"wb_incandescent","payload":"change","payloadType":"str","topic":"ape/corredor/luz/change","x":896.9108581542969,"y":2822.4388122558594,"wires":[["118b70a3.2dcd87","1a9d808.a22308"]]},{"id":"6322e62a.b10b4","type":"ui_text","z":"a76391e.e9c7d7","group":"7ac0c575.b52f2c","order":6,"width":2,"height":1,"name":"","label":"","format":"{{msg.payload}}","layout":"row-center","x":905.7499389648438,"y":3023.888946533203,"wires":[]},{"id":"ac150ae3.32f708","type":"ui_text","z":"a76391e.e9c7d7","group":"a095bd78.a8514","order":13,"width":"2","height":"1","name":"","label":"","format":"{{msg.payload}}","layout":"row-center","x":939.910888671875,"y":3101.43896484375,"wires":[]},{"id":"3008cb38.7f2f34","type":"mqtt in","z":"a76391e.e9c7d7","name":"","topic":"ape/corredor/luz1","qos":"1","datatype":"auto","broker":"25167bbc.e1295c","x":150,"y":3340,"wires":[["b6c80a2f.847ae8","e4b38828.94dd5","cf376033.51d928"]]},{"id":"9465b069.494b3","type":"mqtt out","z":"a76391e.e9c7d7","name":"","topic":"","qos":"","retain":"","broker":"25167bbc.e1295c","x":949.1984252929688,"y":3298.055938720703,"wires":[]},{"id":"c08aa125.90f7a","type":"change","z":"a76391e.e9c7d7","name":"","rules":[{"t":"change","p":"payload","pt":"msg","from":"disconnect","fromt":"str","to":"disconnect","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"on","fromt":"str","to":"Ligado","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"off","fromt":"str","to":"Desligado","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":813.3927612304688,"y":3467.1114196777344,"wires":[["d9c5a61d.ce7da","98e95b68.4d1068","96c9bc07.879c9"]]},{"id":"36986ee4.3bbf22","type":"mqtt in","z":"a76391e.e9c7d7","name":"","topic":"ape/corredor","qos":"1","datatype":"auto","broker":"25167bbc.e1295c","x":226.44839477539062,"y":3249.8893432617188,"wires":[["6ddec6c8.cbf93","cf376033.51d928"]]},{"id":"b6c80a2f.847ae8","type":"switch","z":"a76391e.e9c7d7","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"disconnect","vt":"str"},{"t":"neq","v":"disconnect","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":648.3928527832031,"y":3425.44482421875,"wires":[["d9c5a61d.ce7da","98e95b68.4d1068","5d6207c6.46697"],["c08aa125.90f7a","df983494.a8eee8"]]},{"id":"72d86df8.667d8c","type":"comment","z":"a76391e.e9c7d7","name":"Alterar","info":"","x":226.72610473632812,"y":3199.8892822265625,"wires":[]},{"id":"e4b38828.94dd5","type":"debug","z":"a76391e.e9c7d7","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":370,"y":3420,"wires":[]},{"id":"6ddec6c8.cbf93","type":"debug","z":"a76391e.e9c7d7","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":397.3929138183594,"y":3166.2504272460938,"wires":[]},{"id":"97a71580.d01c38","type":"comment","z":"a76391e.e9c7d7","name":"View Celular","info":"locationid/deviceid/mqttAtuadorId/change\n\nape/teste/luz1/change","x":710.3037719726562,"y":3162.0892333984375,"wires":[]},{"id":"83b97352.b34a58","type":"comment","z":"a76391e.e9c7d7","name":"View Celular","info":"locationid/deviceid/mqttAtuadorId/change\n\nape/teste/luz1/change","x":1044.3037719726562,"y":3463.0892333984375,"wires":[]},{"id":"2a29e366.0e9384","type":"comment","z":"a76391e.e9c7d7","name":"Alterar topic","info":"locationid/deviceid/mqttAtuadorId/change\n\nape/teste/luz1/change","x":734.3037719726562,"y":3255.689239501953,"wires":[]},{"id":"d43a4346.b9054","type":"ui_button","z":"a76391e.e9c7d7","name":"","group":"7ac0c575.b52f2c","order":1,"width":2,"height":1,"passthru":false,"label":"Sala","tooltip":"","color":"","bgcolor":"","icon":"wb_incandescent","payload":"change","payloadType":"str","topic":"ape/corredor/luz1/change","x":731.6428833007812,"y":3296.5281982421875,"wires":[["9465b069.494b3","77650db1.734914"]]},{"id":"5c02e334.067edc","type":"ui_button","z":"a76391e.e9c7d7","name":"","group":"a095bd78.a8514","order":15,"width":"2","height":"1","passthru":false,"label":"Sala","tooltip":"","color":"","bgcolor":"","icon":"wb_incandescent","payload":"change","payloadType":"str","topic":"ape/corredor/luz1/change","x":720.3037719726562,"y":3194.689239501953,"wires":[["9465b069.494b3"]]},{"id":"d9c5a61d.ce7da","type":"ui_text","z":"a76391e.e9c7d7","group":"7ac0c575.b52f2c","order":2,"width":2,"height":1,"name":"","label":"","format":"{{msg.payload}}","layout":"row-center","x":992.142822265625,"y":3421.1392517089844,"wires":[]},{"id":"98e95b68.4d1068","type":"ui_text","z":"a76391e.e9c7d7","group":"a095bd78.a8514","order":16,"width":"2","height":"1","name":"","label":"","format":"{{msg.payload}}","layout":"row-center","x":1010,"y":3500,"wires":[]},{"id":"809d4a29.ab71d","type":"function","z":"a76391e.e9c7d7","name":"Enable/Disable editado sala","func":"var msg1 = msg\nvar msg2\nvar dateNow = new Date();\nenvia_pushover = context.get('c_envia_pushover')\nvar old_time = context.get('c_time') || 0\n\nif(msg.payload === \"input\") {\n\n    dif_date = (dateNow - old_time)/1000/60\n    // if(context.get('c_envia_pushover') === \"sim\"){\n    //     if(dif_date >= 6.20){\n    //         msg2 = { payload:\"disconected\"};\n\n        // }\n    }\n\n    // return [null, msg2]\n    \n// } else {\n\n    if(msg.payload === \"on\"){\n        msg.payload = \"Ligado\"\n        msg.enabled = true\n        msg2 = {enabled: true};\n        return [msg1, msg2]\n    } else {\n        if(msg.payload === \"off\"){\n            msg.payload = \"Desligado\"\n            msg.enabled = true\n            msg2 = {enabled: true};\n            return [msg1, msg2]\n        } else {\n            if(msg.payload === \"disconnect\"){\n                msg.payload = \"Desconectado\"\n                msg.enabled = false\n                context.set(\"c_time\", dateNow)\n\n                return [msg1, msg1]\n            }\n            \n        }\n    }\n// }\n\nreturn [msg1, null]\n\n","outputs":2,"noerr":0,"initialize":"","finalize":"","x":620,"y":2920,"wires":[["2d01e2e5.e0f3ae","4055354d.13ba1c","6322e62a.b10b4","ac150ae3.32f708","4a086819.16b65"],["d43a4346.b9054","8b62d3f6.cb5b5"]]},{"id":"3bcdde90.996fb2","type":"comment","z":"a76391e.e9c7d7","name":"Alterar group","info":"Alterar group dashboard\n","x":910.0000305175781,"y":2982.0001220703125,"wires":[]},{"id":"364b7497.ddb84c","type":"mqtt in","z":"a76391e.e9c7d7","name":"","topic":"ape/teste/dht","qos":"1","datatype":"auto","broker":"25167bbc.e1295c","x":217.29718017578125,"y":1798.26953125,"wires":[["a5285041.cb554","9f6df1e9.968fe8"]]},{"id":"a5285041.cb554","type":"json","z":"a76391e.e9c7d7","name":"","property":"payload","action":"","pretty":false,"x":435.1805114746094,"y":1802.1527709960938,"wires":[["b84dee9e.a51888","3405657e.53d462","8d6f7259.56811"]]},{"id":"b84dee9e.a51888","type":"function","z":"a76391e.e9c7d7","name":"","func":"var topico = \"teste\"     // editar para outro comodo\n\nvar msgU;\nvar msgT;\nvar dateNow = new Date();\n msg.enabled = false;\nif(msg.payload === \"input\") {\n\n    dif_date = (dateNow - context.get('c_time'))/1000/60\n\n\n    if(dif_date >= 6.20){\n\n        msgU = { payload: '-', topic: topico};\n        msgT = { payload: '-', topic: topico};\n    }\n    \n} else {\n\n\nu = msg.payload.u\n    if(msg.payload.u === \"0.00\" && msg.payload.t === \"0.00\"){\n        msgU = { payload: '-', topic: topico};\n        msgT = { payload: '-', topic: topico};\n    } else {\n        msgU = { payload: msg.payload.u, topic: topico};\n        msgT = { payload: msg.payload.t, topic: topico};\n    }\n    context.set(\"c_time\", dateNow)\n\n}\n\nreturn [msgU, msgT]\n","outputs":2,"noerr":0,"x":617.1804809570312,"y":1809.1527709960938,"wires":[["8110a01.b1fe66"],["daa936e1.495f28","d4880c7d.f1f938","e1d1067e.06c9e"]]},{"id":"bcd1ea62.d6f788","type":"comment","z":"a76391e.e9c7d7","name":"View Celular","info":"locationid/deviceid/mqttAtuadorId/change\n\nape/teste/luz1/change","x":1021.9304809570312,"y":1805.9529418945312,"wires":[]},{"id":"daa936e1.495f28","type":"ui_text","z":"a76391e.e9c7d7","group":"aabedb75.31173","order":3,"width":2,"height":1,"name":"","label":"Temp","format":"{{msg.payload | number:1}} °C ","layout":"col-center","x":795.413818359375,"y":1894.6640014648438,"wires":[]},{"id":"d4880c7d.f1f938","type":"ui_text","z":"a76391e.e9c7d7","group":"a095bd78.a8514","order":8,"width":"2","height":"1","name":"","label":"Temperatura","format":"{{msg.payload | number:1}} °C ","layout":"col-center","x":1025.4302368164062,"y":1841.5029907226562,"wires":[]},{"id":"e1d1067e.06c9e","type":"debug","z":"a76391e.e9c7d7","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":864.4222412109375,"y":1677.14453125,"wires":[]},{"id":"9f6df1e9.968fe8","type":"debug","z":"a76391e.e9c7d7","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":410,"y":1700,"wires":[]},{"id":"1b8b722.8aa7d0e","type":"inject","z":"a76391e.e9c7d7","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"u\":\"66.00\",\"t\":\"25.90\"}","payloadType":"str","x":201.79718017578125,"y":1694.26953125,"wires":[["a5285041.cb554"]]},{"id":"64e7da92.dda194","type":"comment","z":"a76391e.e9c7d7","name":"Alterar topico","info":"Alterar variavel topico\n","x":615.2971801757812,"y":1773.26953125,"wires":[]},{"id":"d2df8a81.a5a66","type":"link in","z":"a76391e.e9c7d7","name":"input 5 min","links":["753e508a.6a4198"],"x":446.04718017578125,"y":1740.01953125,"wires":[["b84dee9e.a51888"]],"l":true,"info":"5 min\n"},{"id":"5f06db6b.b1cbbc","type":"ui_template","z":"f91e3b4.e8602c8","group":"4c24412b.903b68","name":"ape/corredor","order":2,"width":4,"height":4,"format":"<svg width=\"180\" height=\"35\">\n    \n    <circle id=\"circle1\" cx=\"20\" cy=\"20\" r=\"10\"\n            style=\"stroke: none; fill: {{msg.payload.status}}\"/>\n    <text font-size=\"18px\" font-weight=\"bold\" \n            x=\"48\" y=\"25\"  fill=\"white\">{{msg.payload.device}}</text>\n</svg>\n<table width=180px>\n\n  <tr>\n    <td>IP</td>\n     <td align=\"right\"><B>{{msg.payload.ip}}</B></td>\n  </tr>\n  <tr>\n    <td>UpTime</td>\n    <td align=\"right\"><B>{{msg.payload.up}}</B></td>\n  </tr>\n  <tr>\n    <td>Reset</td>\n    <td align=\"right\"><B>{{msg.payload.reset}}</B></td>\n  </tr>\n    <tr>\n    <td>Versao</td>\n    <td align=\"right\"><B>{{msg.payload.ver}}</B></td>\n  </tr>\n  <tr>\n    <td>UpDate</td>\n    <td align=\"right\"><B>{{msg.payload.date | date:'dd/MM - HH:mm'}}</B></td>\n  </tr>\n</table>\n\n\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1070,"y":200,"wires":[[]]},{"id":"14409f30.543669","type":"inject","z":"b5a5d7d1.da846","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"2","payloadType":"str","x":150,"y":740,"wires":[["80277fb0.3086a"]]},{"id":"45eccb9f.09ab44","type":"inject","z":"b5a5d7d1.da846","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"1","payloadType":"str","x":250,"y":640,"wires":[["32273396.c12a24","e2a75054.bcec5"]]},{"id":"32273396.c12a24","type":"function","z":"b5a5d7d1.da846","name":"calcular tempo de luz acessa","func":"var now = new Date();   // current time\n\n\ndaynow = now.getDate()\n\n//msg.daynow = daynow\nmsg.timestamp = now\n\nif (msg.payload == 1)\n{\n    flow.set(\"teste_time\", now)\n} else {\n    msg.diferenca = (now - flow.get(\"teste_time\"))/1000/60\n\n}\n\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":540,"y":680,"wires":[["9314ff2f.99f1a8"]]},{"id":"9314ff2f.99f1a8","type":"debug","z":"b5a5d7d1.da846","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":810,"y":680,"wires":[]},{"id":"b9f0b136.b418e","type":"inject","z":"b5a5d7d1.da846","name":"Force","repeat":"","crontab":"","once":false,"onceDelay":"","topic":"","payload":"","payloadType":"date","x":250,"y":920,"wires":[["2baa0e70.55fb0a"]]},{"id":"11cd71a.a76230e","type":"debug","z":"b5a5d7d1.da846","name":"output","active":false,"console":"false","complete":"true","x":842,"y":848,"wires":[]},{"id":"b27f32c6.8b2af","type":"function","z":"b5a5d7d1.da846","name":"timeConvert","func":"if ( !msg.timestamp ) msg.timestamp = Math.round(+new Date());\n\nvar dt = new Date(msg.timestamp);\nvar msg = {\n\t'month':\tdt.getMonth() + 1,\n\t'day':\t\tdt.getDate(),\n\t'year':\t\tdt.getFullYear(),\n\t'hours':\tdt.getHours(),\n\t'mins':\t\tdt.getMinutes(),\n\t'msecs':\tdt.getMilliseconds()\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":646,"y":848,"wires":[["11cd71a.a76230e"]]},{"id":"2baa0e70.55fb0a","type":"function","z":"b5a5d7d1.da846","name":"set timestamp","func":"//msg.timestamp=1376763133 * 1000;\n\n\n/////////////////////////////////////////////\n\n////////////////////////////////////////////\n//                      d  m SMMM\nmsg.timestamp   =   1582805105000\nmsg.timestamp2  =   1582917105000\n/*                   |\nmsg.timestamp   =   1582805105000\nmsg.timestamp2  =   1582916165000\n*/\nvar dt = new Date(msg.timestamp);\nvar dt2 = new Date(msg.timestamp2);\n\nmouthnow = dt.getMonth() + 1\nmouthnow2 = dt2.getMonth() + 1\n\nmsg.mouthnow = mouthnow\nmsg.mouthnow2 = mouthnow2\n\ndaynow = dt.getDate()\ndaynow2 = dt2.getDate()\n\nhournow = dt.getHours()\nhournow2 = dt2.getHours()\nmsg.hournow2 = hournow2\n\nminnow = dt.getMinutes()\nminnow2 = dt2.getMinutes()\nmsg.minnow2 = minnow2\n\nmsg.ligado_total_0 = 0\nmsg.ligado_total_1 =  Math.round((dt2 - dt)/1000/60)\n\nnode.warn(\"mouthnow = \\t\" + mouthnow + \"\\mouthnow2 = \\t\" + mouthnow2);\n\nif ((daynow2 > daynow) || (mouthnow2 > mouthnow)){\n\n//    msg.ligado_total_0 = (dt2 - dt)/1000/60 // - (hournow2 * 60 + minnow2)\n    msg.ligado_total_1 = Math.round((dt2 - dt)/1000/60 - (hournow2 * 60 + minnow2))\n    msg.ligado_total_2 = Math.round((hournow2 * 60) + minnow2)\n    \n}\nreturn msg;\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":434,"y":920,"wires":[["b27f32c6.8b2af","b12ca3d9.d21728"]]},{"id":"1914cc9a.1490e3","type":"inject","z":"b5a5d7d1.da846","name":"Force","repeat":"","crontab":"","once":false,"topic":"","payload":"","payloadType":"date","x":250,"y":848,"wires":[["b27f32c6.8b2af"]]},{"id":"b12ca3d9.d21728","type":"debug","z":"b5a5d7d1.da846","name":"output","active":true,"console":"false","complete":"true","x":650,"y":920,"wires":[]},{"id":"e2a75054.bcec5","type":"debug","z":"b5a5d7d1.da846","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":490,"y":620,"wires":[]},{"id":"80277fb0.3086a","type":"delay","z":"b5a5d7d1.da846","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":320,"y":740,"wires":[["32273396.c12a24"]]},{"id":"177dd60.1314e2a","type":"function","z":"a76391e.e9c7d7","name":"Calculo tempo aceso","func":"var now = new Date();   // current time\nvar time_on = context.get(\"time_on\") || 0 \n\n\nif (msg.payload == \"on\"){\n    if(time_on === 0){\n        context.set(\"time_on\", now)\n        node.warn(\"iniciou coleta tempo \" + now);\n    }\n} else {\n    if(time_on !== 0){\n        if (msg.payload == \"off\"){\n\n            start = context.get(\"time_on\")\n            Start_day =\t\tstart.getDate()\n            Start_month =\tstart.getMonth() + 1\n            Start_year =\tstart.getFullYear()\n            Start_hours =\tstart.getHours()\n            Start_mins =\tstart.getMinutes()\n    \n            Fim_day =\tnow.getDate()\n            Fim_month =\tnow.getMonth() + 1\n            Fim_year =\tnow.getFullYear()\n            Fim_hours =\tnow.getHours()\n            Fim_mins =\tnow.getMinutes()\n    \n            node.warn(\"finalizou coleta tempo\\ninicio = \" + context.get(\"time_on\") + \"\\nfinal =  \" + now );\n        \n            msg.tempo_ligado = Math.round((now - context.get(\"time_on\"))/1000/60)\n            msg.dia = Start_year +\"-\"+ Start_month +\"-\"+ Start_day\n        \n            context.set(\"time_on\", 0)\n            \n            if ((Fim_day > Start_day) || (Fim_month > Start_month) || (Fim_year > Start_year)){\n                msg.tempo_ligado = Math.round(1440 -  ((Start_hours * 60) + Start_mins))\n                msg.tempo_ligado_1 = Math.round((Fim_hours * 60) + Fim_mins)\n                msg.dia = Start_year +\"-\"+ Start_month +\"-\"+ Start_day\n                msg.dia_1 = Fim_year +\"-\"+ Fim_month +\"-\"+ Fim_day\n            }\n            \n            if (msg.tempo_ligado !== 0){\n                msg.flow_time_on1 = time_on\n                return msg\n            }\n        }\n    }\n}\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":954.4222412109375,"y":937.14453125,"wires":[["c2429ca7.2618b","d083c910.d4c55","2fd6f106.9f5e86"]],"info":"if ( !msg.timestamp ) msg.timestamp = Math.round(+new Date());\n\nvar dt = new Date(msg.timestamp);\nvar msg = {\n\t'month':\tdt.getMonth() + 1,\n\t'day':\t\tdt.getDate(),\n\t'year':\t\tdt.getFullYear(),\n\t'hours':\tdt.getHours(),\n\t'mins':\t\tdt.getMinutes(),\n\t'msecs':\tdt.getMilliseconds()\n}\n\nreturn msg;"},{"id":"c2429ca7.2618b","type":"debug","z":"a76391e.e9c7d7","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1184.4222412109375,"y":897.14453125,"wires":[]},{"id":"41c0e277.6a6d64","type":"http request","z":"b5a5d7d1.da846","name":"","method":"POST","ret":"txt","paytoqs":false,"url":"http://localhost/post-esp-data.php","tls":"","proxy":"","authType":"","x":550,"y":1220,"wires":[["e50ac458.4ace28","c04c707c.ec5028"]]},{"id":"6586adcb.630b54","type":"inject","z":"b5a5d7d1.da846","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":240,"y":1220,"wires":[["746c8c27.1e59a4"]]},{"id":"746c8c27.1e59a4","type":"function","z":"b5a5d7d1.da846","name":"","func":"msg.headers = {'content-type':'application/x-www-form-urlencoded'};\n//msg.payload = { api_key: \"api_key_value\", sensor: \"luz\", location:\"telefonica\", value1: \"11\", value2: \"22\", value3: \"33\" };\nmsg.payload = { api_key: \"api_key_Clima\", sensor: \"luz\", location:\"telefonica\", value1: \"11\", value2: \"22\", value3: \"33\" };\n\nreturn msg;","outputs":1,"noerr":0,"x":390,"y":1220,"wires":[["41c0e277.6a6d64"]]},{"id":"e50ac458.4ace28","type":"debug","z":"b5a5d7d1.da846","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":730,"y":1220,"wires":[]},{"id":"c04c707c.ec5028","type":"debug","z":"b5a5d7d1.da846","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":530,"y":1160,"wires":[]},{"id":"68726097.2191b","type":"function","z":"a76391e.e9c7d7","name":"http post data","func":"var sTopico = \"quarto\"     // editar para outro comodo - usado para o grafico\nvar sSensor = \"dht\"\nvar sTemperatura = msg.payload.t\nvar sUmidade = msg.payload.u\n\nif(msg.payload !== \"input\") {\n\n    if(msg.payload.u !== \"0.00\" && msg.payload.t !== \"0.00\"){\n        msg.headers = {'content-type':'application/x-www-form-urlencoded'};\n        msg.payload = { api_key: \"api_key_value\", table:\"Clima\", localidade: sTopico, sensor:sSensor, temperatura: sTemperatura, umidade: sUmidade};\n        return msg\n\n    }\n\n}\n\n \n","outputs":1,"noerr":0,"x":534.4222412109375,"y":2377.14453125,"wires":[["963bce4c.863fa"]]},{"id":"963bce4c.863fa","type":"http request","z":"a76391e.e9c7d7","name":"","method":"POST","ret":"txt","paytoqs":false,"url":"http://localhost/post-esp-data.php","tls":"","proxy":"","authType":"","x":724.4222412109375,"y":2377.14453125,"wires":[["bfd66a4c.bb2898"]]},{"id":"bfd66a4c.bb2898","type":"debug","z":"a76391e.e9c7d7","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":924.4222412109375,"y":2377.14453125,"wires":[]},{"id":"190a3bfd.7ff84c","type":"debug","z":"f91e3b4.e8602c8","name":"Status_json","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":550,"y":320,"wires":[]},{"id":"e0fa477f.2340d","type":"function","z":"9271b3dc.6bcd3","name":"http post data","func":"var sTopico = \"externo\"     // editar para outro comodo - usado para o grafico\nvar sSensor = \"climaTempo\"\nvar sTemperatura = msg.payload.data.temperature\nvar sUmidade = msg.payload.data.humidity\n\nif(msg.payload !== \"input\") {\n\n    if(msg.payload.u !== \"0.00\" && msg.payload.t !== \"0.00\"){\n        msg.headers = {'content-type':'application/x-www-form-urlencoded'};\n        msg.payload = { api_key: \"api_key_value\", table:\"Clima\", localidade: sTopico, sensor:sSensor, temperatura: sTemperatura, umidade: sUmidade};\n        return msg\n\n    }\n\n}\n\n \n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":700,"y":240,"wires":[["f7bbdc31.11cfc8","3e050a2d.480a9e"]]},{"id":"f7bbdc31.11cfc8","type":"http request","z":"9271b3dc.6bcd3","name":"","method":"POST","ret":"txt","paytoqs":"ignore","url":"http://localhost/post-esp-data.php","tls":"","persist":false,"proxy":"","authType":"","x":910,"y":240,"wires":[["b090add.642d95"]]},{"id":"8d6f7259.56811","type":"function","z":"a76391e.e9c7d7","name":"http post data","func":"var sTopico = \"telefonica\"     // editar para outro comodo - usado para o grafico\nvar sSensor = \"dht\"\nvar sTemperatura = msg.payload.t\nvar sUmidade = msg.payload.u\n\nif(msg.payload !== \"input\") {\n\n    if(msg.payload.u !== \"0.00\" && msg.payload.t !== \"0.00\"){\n        msg.headers = {'content-type':'application/x-www-form-urlencoded'};\n        msg.payload = { api_key: \"api_key_value\", table:\"Clima\", localidade: sTopico, sensor:sSensor, temperatura: sTemperatura, umidade: sUmidade};\n        return msg\n\n    }\n\n}\n\n \n","outputs":1,"noerr":0,"x":634.4222412109375,"y":1977.14453125,"wires":[["a94b9725.0d03c"]]},{"id":"a94b9725.0d03c","type":"http request","z":"a76391e.e9c7d7","name":"","method":"POST","ret":"txt","paytoqs":false,"url":"http://localhost/post-esp-data.php","tls":"","proxy":"","authType":"","x":824.4222412109375,"y":1977.14453125,"wires":[["50dbef0f.8fb2b"]]},{"id":"50dbef0f.8fb2b","type":"debug","z":"a76391e.e9c7d7","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1024.4222412109375,"y":1977.14453125,"wires":[]},{"id":"711cdc23.3fa14c","type":"http request","z":"a76391e.e9c7d7","name":"","method":"POST","ret":"txt","paytoqs":false,"url":"http://localhost/post-esp-data.php","tls":"","proxy":"","authType":"","x":1264.4222412109375,"y":997.14453125,"wires":[["3e889d9.fbc3662"]]},{"id":"2fd6f106.9f5e86","type":"function","z":"a76391e.e9c7d7","name":"http post data","func":"var sLocalidade = \"telefonica\"     // editar para outro comodo - usado para o grafico\nvar sData = msg.dia\nvar sTempoLigado = msg.tempo_ligado\n\n\nif(msg.payload !== \"input\") {\n\n    if(msg.payload.u !== \"0.00\" && msg.payload.t !== \"0.00\"){\n        msg.headers = {'content-type':'application/x-www-form-urlencoded'};\n            msg.payload = { api_key: \"api_key_value\", table:\"TempoLuz\", localidade: sLocalidade, data:sData, tempoligado: sTempoLigado};\n        return msg\n\n    }\n\n}\n\n \n","outputs":1,"noerr":0,"x":1014.4222412109375,"y":997.14453125,"wires":[["711cdc23.3fa14c"]]},{"id":"3e889d9.fbc3662","type":"debug","z":"a76391e.e9c7d7","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1224.4222412109375,"y":1097.14453125,"wires":[]},{"id":"d083c910.d4c55","type":"debug","z":"a76391e.e9c7d7","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"dia","targetType":"msg","x":1154.4222412109375,"y":1157.14453125,"wires":[]},{"id":"63515e37.fc6008","type":"function","z":"a76391e.e9c7d7","name":"Calculo tempo aceso","func":"var now = new Date();   // current time\nvar time_on = context.get(\"time_on\") || 0 \n\n\nif (msg.payload == \"on\"){\n    if(time_on === 0){\n        context.set(\"time_on\", now)\n        // node.warn(\"iniciou coleta tempo \" + now);\n    }\n} else {\n    if(time_on !== 0){\n        if (msg.payload == \"off\"){\n\n            start = context.get(\"time_on\")\n            Start_day =\t\tstart.getDate()\n            Start_month =\tstart.getMonth() + 1\n            Start_year =\tstart.getFullYear()\n            Start_hours =\tstart.getHours()\n            Start_mins =\tstart.getMinutes()\n    \n            Fim_day =\tnow.getDate()\n            Fim_month =\tnow.getMonth() + 1\n            Fim_year =\tnow.getFullYear()\n            Fim_hours =\tnow.getHours()\n            Fim_mins =\tnow.getMinutes()\n    \n            // node.warn(\"finalizou coleta tempo\\ninicio = \" + context.get(\"time_on\") + \"\\nfinal =  \" + now );\n        \n            msg.tempo_ligado = Math.round((now - context.get(\"time_on\"))/1000/60)\n            msg.dia = Start_year +\"-\"+ Start_month +\"-\"+ Start_day\n        \n            context.set(\"time_on\", 0)\n            \n            if ((Fim_day > Start_day) || (Fim_month > Start_month) || (Fim_year > Start_year)){\n                msg.tempo_ligado = Math.round(1440 -  ((Start_hours * 60) + Start_mins))\n                msg.tempo_ligado_1 = Math.round((Fim_hours * 60) + Fim_mins)\n                msg.dia = Start_year +\"-\"+ Start_month +\"-\"+ Start_day\n                msg.dia_1 = Fim_year +\"-\"+ Fim_month +\"-\"+ Fim_day\n            }\n            \n            if (msg.tempo_ligado !== 0){\n                msg.flow_time_on1 = time_on\n                return msg\n            }\n        }\n    }\n}\n","outputs":1,"noerr":0,"x":300,"y":600,"wires":[["3e999854.c471b8"]],"info":"if ( !msg.timestamp ) msg.timestamp = Math.round(+new Date());\n\nvar dt = new Date(msg.timestamp);\nvar msg = {\n\t'month':\tdt.getMonth() + 1,\n\t'day':\t\tdt.getDate(),\n\t'year':\t\tdt.getFullYear(),\n\t'hours':\tdt.getHours(),\n\t'mins':\t\tdt.getMinutes(),\n\t'msecs':\tdt.getMilliseconds()\n}\n\nreturn msg;"},{"id":"3e999854.c471b8","type":"function","z":"a76391e.e9c7d7","name":"http post data","func":"var sLocalidade = msg.topic.split('/')[1];   \nvar sData = msg.dia\nvar sTempoLigado = msg.tempo_ligado\n\n\nif(msg.payload !== \"input\") {\n\n    if(msg.payload.u !== \"0.00\" && msg.payload.t !== \"0.00\"){\n        msg.headers = {'content-type':'application/x-www-form-urlencoded'};\n            msg.payload = { api_key: \"api_key_value\", table:\"TempoLuz\", localidade: sLocalidade, data:sData, tempoligado: sTempoLigado};\n        return msg\n\n    }\n\n}\n\n \n","outputs":1,"noerr":0,"x":500,"y":600,"wires":[["c3914de0.fce46","84cf7220.b49b6"]]},{"id":"c3914de0.fce46","type":"http request","z":"a76391e.e9c7d7","name":"","method":"POST","ret":"txt","paytoqs":false,"url":"http://localhost/post-esp-data.php","tls":"","proxy":"","authType":"","x":690,"y":600,"wires":[["da9486a0.146fd8"]]},{"id":"da9486a0.146fd8","type":"debug","z":"a76391e.e9c7d7","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":870,"y":600,"wires":[]},{"id":"5ef7c0d5.7e5818","type":"inject","z":"a76391e.e9c7d7","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"ape/teste/luz","payload":"off","payloadType":"str","x":914.4222412109375,"y":797.14453125,"wires":[["177dd60.1314e2a"]]},{"id":"7a4efed2.b6c18","type":"inject","z":"a76391e.e9c7d7","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"ape/teste/luz","payload":"on","payloadType":"str","x":914.4222412109375,"y":757.14453125,"wires":[["177dd60.1314e2a"]]},{"id":"e0113b37.08907","type":"http request","z":"9271b3dc.6bcd3","name":"GET ClimaTempo Previsão","method":"GET","ret":"obj","paytoqs":"ignore","url":"http://apiadvisor.climatempo.com.br/api/v1/forecast/locale/3477/days/15?token=6437f1eb0ce7916ac9dcf5338023d66d","tls":"","persist":false,"proxy":"","authType":"","x":482,"y":365.0000228881836,"wires":[["dd0aafdf.6aee98","661416c5.60dae8"]]},{"id":"1b24a232.7b668e","type":"inject","z":"9271b3dc.6bcd3","name":"every day 00:01","repeat":"","crontab":"01 00 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":192,"y":365.0000228881836,"wires":[["e0113b37.08907"]]},{"id":"7479293d.7dc56","type":"ui_template","z":"9271b3dc.6bcd3","group":"8e7b88aa.51306","name":"HTML Temperatura","order":1,"width":4,"height":7,"format":"<center>\n<table border=0 cellspacing=\"1\">\n    <TR>\n        <TD ALIGN='center' COLSPAN = \"3\">\n           <font size=\"3\">{{msg.payload.name}} - {{msg.payload.state}}</font>\n        </TD>\n    </TR>\n    <TR>\n        <TD ROWSPAN=\"2\">\n            <img style=\"display: block; margin-left: auto; margin-right: auto;\" src=/{{msg.payload.data.icon}}.png width=\"55\" height=\"55\">\n        </TD>\n\t\t<TH ROWSPAN=\"2\">    \n            <font size=\"7\">{{msg.payload.data.temperature}}°</font>\n        </TH>\n    \t<TD>\n            <font size=\"2\">&darr;{{msg.payload.data[0].temperature.min}}°&uarr;{{msg.payload.data[0].temperature.max}}°</font>    \n        </TD>\n \t</TR>\n    <TR>\n    \t<TH>\n            <font size=\"4\">{{msg.payload.data.humidity}}%</font>    \n        </TH>\n    </TR>\n    <TR>\n        <TD  align='center' COLSPAN = \"3\">\n            <font size=\"3\">{{msg.payload.data.condition}}</font>\n        </TD>\n    </TR>\n</table>\n\n <hr width=\"50%\"> \n\n<p align ='Center'><font size=\"3\"><B>Amanhã</B></font></p>\n<p align ='Center'><font size=\"3\">{{msg.payload.data[1].text_icon.text.pt}}</font></p>\n\n<table align ='Center' >\n    <tr>\n    \t<td style = \"padding: 3px\" COLSPAN=\"2\"><font size=\"4\">&#127785;</font>{{msg.payload.data[1].rain.probability}}% </td>\n    \t<td style = \"padding: 3px\" COLSPAN=\"2\"><img src=\"http://www.climatempo.com.br/dist/images/gota-azul.png\" width=\"10\" height=\"10\">{{msg.payload.data[1].rain.precipitation}}<font size=\"2\">mm</font></td>\n    </tr>\n    <tr>\n        <td style = \"padding: 3px\">Manha </td>\n        <td style = \"padding: 3px\"><img style=\"display: block; margin-left: auto; margin-right: auto;\" src=/{{msg.payload.data[1].text_icon.icon.morning}}.png width=\"25\" height=\"25\"></td> \n         \n        <td style = \"padding: 3px\" align ='Center'>&darr;{{msg.payload.data[1].temperature.morning.min}}°</td>\n        <td style = \"padding: 3px\" align ='Center'>&uarr;{{msg.payload.data[1].temperature.morning.max}}°</td>\n\t</tr>\n    <tr>\n        <td style = \"padding: 3px\">Tarde</td>\n        <td style = \"padding: 3px\"><img style=\"display: block; margin-left: auto; margin-right: auto;\" src=/{{msg.payload.data[1].text_icon.icon.afternoon}}.png width=\"25\" height=\"25\"></td> \n        <td style = \"padding: 3px\" align ='Center'>&darr;{{msg.payload.data[1].temperature.afternoon.min}}°</td>\n        <td style = \"padding: 3px\" align ='Center'>&uarr;{{msg.payload.data[1].temperature.afternoon.max}}°</td>\n    </tr>\n\t<tr>\n        <td style = \"padding: 3px\">Noite</td>\n        <td style = \"padding: 3px\"><img style=\"display: block; margin-left: auto; margin-right: auto;\" src=/{{msg.payload.data[1].text_icon.icon.night}}.png width=\"25\" height=\"25\"></td> \n        <td style = \"padding: 3px\" align ='Center'>&darr;{{msg.payload.data[1].temperature.night.min}}°</td>\n        <td style = \"padding: 3px\" align ='Center'>&uarr;{{msg.payload.data[1].temperature.night.max}}°</td>\n    </tr>\n\n</table>\n\n<p align='Center'><font size=\"2\">Update {{msg.payload.update}}</font></p>\n</center>","storeOutMessages":false,"fwdInMessages":true,"templateScope":"local","x":1010,"y":340,"wires":[[]]},{"id":"98f1714.84d979","type":"ui_template","z":"9271b3dc.6bcd3","group":"a095bd78.a8514","name":"HTML Temperatura","order":18,"width":"6","height":"7","format":"<center>\n<table border=0 cellspacing=\"1\">\n    <TR>\n        <TD ALIGN='center' COLSPAN = \"3\">\n           <font size=\"3\">{{msg.payload.name}} - {{msg.payload.state}}</font>\n        </TD>\n    </TR>\n    <TR>\n        <TD ROWSPAN=\"2\">\n            <img style=\"display: block; margin-left: auto; margin-right: auto;\" src=/{{msg.payload.data.icon}}.png width=\"55\" height=\"55\">\n        </TD>\n\t\t<TH ROWSPAN=\"2\">    \n            <font size=\"7\">{{msg.payload.data.temperature}}°</font>\n        </TH>\n    \t<TD>\n            <font size=\"2\">&darr;{{msg.payload.data[0].temperature.min}}°&uarr;{{msg.payload.data[0].temperature.max}}°</font>    \n        </TD>\n \t</TR>\n    <TR>\n    \t<TH>\n            <font size=\"5\">{{msg.payload.data.humidity}}%</font>    \n        </TH>\n    </TR>\n    <TR>\n        <TD  align='center' COLSPAN = \"3\">\n            <font size=\"3\">{{msg.payload.data.condition}}</font>\n        </TD>\n    </TR>\n</table>\n\n <hr width=\"50%\"> \n\n<p align ='Center'><font size=\"3\"><B>Amanhã</B></font></p>\n<p align ='Center'><font size=\"3\">{{msg.payload.data[1].text_icon.text.pt}}</font></p>\n\n<table align ='Center' >\n    <tr>\n    \t<td style = \"padding: 3px\" COLSPAN=\"2\"><font size=\"4\">&#127785;</font>{{msg.payload.data[1].rain.probability}}% </td>\n    \t<td style = \"padding: 3px\" COLSPAN=\"2\"><img src=\"http://www.climatempo.com.br/dist/images/gota-azul.png\" width=\"10\" height=\"10\">{{msg.payload.data[1].rain.precipitation}}<font size=\"2\">mm</font></td>\n    </tr>\n    <tr>\n        <td style = \"padding: 3px\">Manha </td>\n        <td style = \"padding: 3px\"><img style=\"display: block; margin-left: auto; margin-right: auto;\" src=/{{msg.payload.data[1].text_icon.icon.morning}}.png width=\"25\" height=\"25\"></td> \n         \n        <td style = \"padding: 3px\" align ='Center'>&darr;{{msg.payload.data[1].temperature.morning.min}}°</td>\n        <td style = \"padding: 3px\" align ='Center'>&uarr;{{msg.payload.data[1].temperature.morning.max}}°</td>\n\t</tr>\n    <tr>\n        <td style = \"padding: 3px\">Tarde</td>\n        <td style = \"padding: 3px\"><img style=\"display: block; margin-left: auto; margin-right: auto;\" src=/{{msg.payload.data[1].text_icon.icon.afternoon}}.png width=\"25\" height=\"25\"></td> \n        <td style = \"padding: 3px\" align ='Center'>&darr;{{msg.payload.data[1].temperature.afternoon.min}}°</td>\n        <td style = \"padding: 3px\" align ='Center'>&uarr;{{msg.payload.data[1].temperature.afternoon.max}}°</td>\n    </tr>\n\t<tr>\n        <td style = \"padding: 3px\">Noite</td>\n        <td style = \"padding: 3px\"><img style=\"display: block; margin-left: auto; margin-right: auto;\" src=/{{msg.payload.data[1].text_icon.icon.night}}.png width=\"25\" height=\"25\"></td> \n        <td style = \"padding: 3px\" align ='Center'>&darr;{{msg.payload.data[1].temperature.night.min}}°</td>\n        <td style = \"padding: 3px\" align ='Center'>&uarr;{{msg.payload.data[1].temperature.night.max}}°</td>\n    </tr>\n\n</table>\n\n<p align='Center'><font size=\"2\">Update {{msg.payload.update}}</font></p>\n</center>","storeOutMessages":false,"fwdInMessages":true,"templateScope":"local","x":1010,"y":380,"wires":[[]]},{"id":"dd0aafdf.6aee98","type":"function","z":"9271b3dc.6bcd3","name":"","func":"var now = new Date();\nupdate = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});\n\n\nif (msg.payload.data.temperature !== undefined){\n    //msg de tempo atual\n    var payload = {\n        \"name\": msg.payload.name,\n        \"state\": msg.payload.state,\n        \"update\": update,\n        \"data\": {\n            \"temperature\": msg.payload.data.temperature,\n            \"humidity\": msg.payload.data.humidity,\n            \"condition\": msg.payload.data.condition,\n            \"icon\": msg.payload.data.icon,\n        }\n        \n    }\n    context.set(\"today\", payload)\n    \n    var forecast = context.get(\"forecast\") || undefined\n    if (forecast !== undefined){\n        payload.data[1] = forecast.data[1]\n        payload.data[0] = forecast.data[0]\n    }\n} else {\n    //msg de tempo dia seguinte\n    global.set(\"g_sun_rise\", msg.payload.data[0].sun.sunrise)\n    payload = {\n        \"name\": msg.payload.name,\n        \"state\": msg.payload.state,\n        \"update\": update,\n\t\t\"data\": [\n\n\t\t\t{ \n\t\t\t\t\"temperature\": {\n\t\t\t\t\t\t\"min\": msg.payload.data[0].temperature.min,\n\t\t\t\t\t\t\"max\": msg.payload.data[0].temperature.max,\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"rain\": {\n\t\t\t\t\t\"probability\": msg.payload.data[1].rain.probability,\n\t\t\t\t\t\"precipitation\": msg.payload.data[1].rain.precipitation\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t\"text_icon\": {\n\t\t\t\t\t\"icon\": {\n\t\t\t\t\t\t\"morning\": msg.payload.data[1].text_icon.icon.morning,\n\t\t\t\t\t\t\"afternoon\": msg.payload.data[1].text_icon.icon.afternoon,\n\t\t\t\t\t\t\"night\": msg.payload.data[1].text_icon.icon.night,\n\t\t\t\t\t},\n\t\t\t\t\t\"text\": {\n\t\t\t\t\t\t\"pt\": msg.payload.data[1].text_icon.text.pt,\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"temperature\": {\n\t\t\t\t\t\"morning\": {\n\t\t\t\t\t\t\"min\": msg.payload.data[1].temperature.morning.min,\n\t\t\t\t\t\t\"max\": msg.payload.data[1].temperature.morning.max,\n\t\t\t\t\t},\n\t\t\t\t\t\"afternoon\": {\n\t\t\t\t\t\t\"min\": msg.payload.data[1].temperature.afternoon.min,\n\t\t\t\t\t\t\"max\": msg.payload.data[1].temperature.afternoon.max,\n\t\t\t\t\t},\n\t\t\t\t\t\"night\": {\n\t\t\t\t\t\t\"min\": msg.payload.data[1].temperature.night.min,\n\t\t\t\t\t\t\"max\": msg.payload.data[1].temperature.night.max,\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t]\n    }\n    context.set(\"forecast\", payload)\n\n    var today = context.get(\"today\") || undefined\n    if (today !== undefined){\n        payload = today    \n    \n        payload.data.temperature = today.data.temperature\n        payload.data.humidity = today.data.humidity\n        payload.data.condition = today.data.condition\n        payload.data.icon = today.data.icon\n    }\n    \n}   \n\nmsg.payload = payload\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":821,"y":368,"wires":[["7479293d.7dc56","98f1714.84d979","df53f19e.18037"]]},{"id":"3d606c14.2a2b8c","type":"inject","z":"9271b3dc.6bcd3","name":"2 horas","repeat":"7200","crontab":"","once":true,"onceDelay":"","topic":"","payload":"","payloadType":"date","x":162,"y":405.0000228881836,"wires":[["e0113b37.08907"]]},{"id":"ffe3105f.c53068","type":"comment","z":"9271b3dc.6bcd3","name":"enviar dados para myslq","info":"","x":730,"y":120,"wires":[]},{"id":"1e0b7c4c.3213a4","type":"debug","z":"a76391e.e9c7d7","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":670,"y":3340,"wires":[]},{"id":"b0645db6.ac8608","type":"inject","z":"a76391e.e9c7d7","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"disconnect","payloadType":"str","x":272.6070861816406,"y":2673.7495727539062,"wires":[["809d4a29.ab71d"]]},{"id":"45ee167e.394b08","type":"inject","z":"a76391e.e9c7d7","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":302.6070861816406,"y":2713.7495727539062,"wires":[["809d4a29.ab71d"]]},{"id":"6d4ec190.4ee57","type":"mqtt in","z":"a76391e.e9c7d7","name":"","topic":"ape/sala/jantar","qos":"1","datatype":"auto","broker":"25167bbc.e1295c","x":240,"y":3500,"wires":[["360ed12a.629016","cf376033.51d928"]]},{"id":"360ed12a.629016","type":"debug","z":"a76391e.e9c7d7","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":410,"y":3520,"wires":[]},{"id":"cf376033.51d928","type":"function","z":"a76391e.e9c7d7","name":"Enable/Disable new","func":"var msg1 = msg\nvar msg2\nvar dateNow = new Date();\nenvia_pushover = context.get('c_envia_pushover')\nvar old_time = context.get('c_time') || 0\n\nif(msg.payload === \"input\") {\n\n    dif_date = (dateNow - old_time)/1000/60\n    if(context.get('c_envia_pushover') === \"sim\"){\n        if(dif_date >= 6.20){\n            msg2 = { payload:\"disconected\"};\n            context.set(\"c_envia_pushover\", \"não\")\n        }\n    }\n\n    return [null, msg2]\n    \n} else {\n\n    if(msg.payload === \"on\"){\n        msg.payload = \"Ligado\"\n        // msg.enabled = true\n    } else {\n        if(msg.payload === \"off\"){\n            msg.payload = \"Desligado\"\n            // msg.enabled = true\n        } else {\n            if(msg.payload === \"disconnect\"){\n                msg.payload = \"Disconectado\"\n                // msg.enabled = false\n                context.set(\"c_time\", dateNow)\n                context.set(\"c_envia_pushover\", \"sim\")\n            }\n            \n        }\n    }\n}\n\nreturn [msg1, null]\n\n","outputs":2,"noerr":0,"initialize":"","finalize":"","x":480,"y":3220,"wires":[["5c02e334.067edc","d43a4346.b9054","1e0b7c4c.3213a4","b6c80a2f.847ae8"],[]]},{"id":"dd433b6b.408648","type":"function","z":"b5a5d7d1.da846","name":"","func":"var myString = 'Hello World. How are you doing?';\nvar splits = myString.split(' ');\n\nmsg.splits = splits\n\nreturn msg;\n\n\n\n","outputs":1,"noerr":0,"x":490,"y":1400,"wires":[["77bc1d1a.c7c4ec"]]},{"id":"77bc1d1a.c7c4ec","type":"debug","z":"b5a5d7d1.da846","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":650,"y":1400,"wires":[]},{"id":"d5aa2f67.97cab8","type":"inject","z":"b5a5d7d1.da846","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"\"teste 1234, vai funcionar\"","payloadType":"str","x":310,"y":1400,"wires":[["dd433b6b.408648"]]},{"id":"e1975c02.0b463","type":"ui_template","z":"f91e3b4.e8602c8","group":"6825085.446fbf8","name":"ape/sala","order":2,"width":4,"height":4,"format":"<svg width=\"180\" height=\"35\">\n    \n    <circle id=\"circle1\" cx=\"20\" cy=\"20\" r=\"10\"\n            style=\"stroke: none; fill: {{msg.payload.status}}\"/>\n    <text font-size=\"18px\" font-weight=\"bold\" \n            x=\"48\" y=\"25\"  fill=\"white\">{{msg.payload.device}}</text>\n</svg>\n<table width=180px>\n\n  <tr>\n    <td>IP</td>\n     <td align=\"right\"><B>{{msg.payload.ip}}</B></td>\n  </tr>\n  <tr>\n    <td>UpTime</td>\n    <td align=\"right\"><B>{{msg.payload.up}}</B></td>\n  </tr>\n  <tr>\n    <td>Reset</td>\n    <td align=\"right\"><B>{{msg.payload.reset}}</B></td>\n  </tr>\n    <tr>\n    <td>Versao</td>\n    <td align=\"right\"><B>{{msg.payload.ver}}</B></td>\n  </tr>\n  <tr>\n    <td>UpDate</td>\n    <td align=\"right\"><B>{{msg.payload.date | date:'dd/MM - HH:mm'}}</B></td>\n  </tr>\n</table>\n\n\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1160,"y":320,"wires":[[]]},{"id":"36aa6a60.c3a55e","type":"debug","z":"f91e3b4.e8602c8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":750,"y":240,"wires":[]},{"id":"e71ba605.c87c08","type":"ui_template","z":"f91e3b4.e8602c8","group":"ac46c281.0280d","name":"ape/quartom","order":2,"width":4,"height":4,"format":"<svg width=\"180\" height=\"35\">\n    \n    <circle id=\"circle1\" cx=\"20\" cy=\"20\" r=\"10\"\n            style=\"stroke: none; fill: {{msg.payload.status}}\"/>\n    <text font-size=\"18px\" font-weight=\"bold\" \n            x=\"48\" y=\"25\"  fill=\"white\">{{msg.payload.device}}</text>\n</svg>\n<table width=180px>\n\n  <tr>\n    <td>IP</td>\n     <td align=\"right\"><B>{{msg.payload.ip}}</B></td>\n  </tr>\n  <tr>\n    <td>UpTime</td>\n    <td align=\"right\"><B>{{msg.payload.up}}</B></td>\n  </tr>\n  <tr>\n    <td>Reset</td>\n    <td align=\"right\"><B>{{msg.payload.reset}}</B></td>\n  </tr>\n    <tr>\n    <td>Versao</td>\n    <td align=\"right\"><B>{{msg.payload.ver}}</B></td>\n  </tr>\n  <tr>\n    <td>UpDate</td>\n    <td align=\"right\"><B>{{msg.payload.date | date:'dd/MM - HH:mm'}}</B></td>\n  </tr>\n</table>\n\n\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1070,"y":400,"wires":[[]]},{"id":"3405657e.53d462","type":"debug","z":"a76391e.e9c7d7","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":610,"y":1680,"wires":[]},{"id":"44f6f8b2.c19c78","type":"function","z":"a76391e.e9c7d7","name":"Enable/Disable new","func":"var msg1 = msg\nvar msg2\nvar dateNow = new Date();\nenvia_pushover = context.get('c_envia_pushover')\nvar old_time = context.get('c_time') || 0\n\nif(msg.payload === \"input\") {\n\n    dif_date = (dateNow - old_time)/1000/60\n    if(context.get('c_envia_pushover') === \"sim\"){\n        if(dif_date >= 6.20){\n            msg2 = { payload:\"disconected\"};\n            context.set(\"c_envia_pushover\", \"não\")\n        }\n    }\n\n    return [null, msg2]\n    \n} else {\n\n    if(msg.payload === \"on\"){\n        msg.payload = \"Ligado\"\n        msg.enabled = true\n    } else {\n        if(msg.payload === \"off\"){\n            msg.payload = \"Desligado\"\n            msg.enabled = true\n        } else {\n            if(msg.payload === \"disconnect\"){\n                msg.payload = \"Disconectado\"\n                msg.enabled = false\n                context.set(\"c_time\", dateNow)\n                context.set(\"c_envia_pushover\", \"sim\")\n            }\n            \n        }\n    }\n}\n\nreturn [msg1, null]\n\n","outputs":2,"noerr":0,"x":480,"y":1300,"wires":[["e82d48e7.dce51","d8a3edb3.7d80d8"],["31b40c18.dda714"]]},{"id":"e30c88ca.518b4","type":"function","z":"f1b5c0e6.84dd68","name":"Enable/Disable new","func":"var msg1 = msg\nvar msg2\nvar dateNow = new Date();\nenvia_pushover = context.get('c_envia_pushover')\nvar old_time = context.get('c_time') || 0\n\nif(msg.payload === \"input\") {\n\n    dif_date = (dateNow - old_time)/1000/60\n    if(context.get('c_envia_pushover') === \"sim\"){\n        if(dif_date >= 6.20){\n            msg2 = { payload:\"disconected\"};\n            context.set(\"c_envia_pushover\", \"não\")\n        }\n    }\n\n    return [null, msg2]\n    \n} else {\n\n    if(msg.payload === \"on\"){\n        msg.payload = \"Ligado\"\n        msg.enabled = true\n    } else {\n        if(msg.payload === \"off\"){\n            msg.payload = \"Desligado\"\n            msg.enabled = true\n        } else {\n            if(msg.payload === \"disconnect\"){\n                msg.payload = \"Off Line\"\n                msg.enabled = false\n                context.set(\"c_time\", dateNow)\n                context.set(\"c_envia_pushover\", \"sim\")\n            }\n            \n        }\n    }\n}\n\nreturn [msg1, null]\n\n","outputs":2,"noerr":0,"x":480,"y":640,"wires":[["40dc9e2f.8ffab","d036ba59.122c8","5087505c.97a35","f7ba2f88.4ae7d8"],[]]},{"id":"40dc9e2f.8ffab","type":"ui_button","z":"f1b5c0e6.84dd68","name":"Celular","group":"bd5a1d91.586a88","order":1,"width":"2","height":"1","passthru":false,"label":"Umidificador","tooltip":"","color":"","bgcolor":"","icon":"wb_incandescent","payload":"change","payloadType":"str","topic":"","x":700,"y":660,"wires":[["32bbb111.c40afe"]]},{"id":"d036ba59.122c8","type":"ui_text","z":"f1b5c0e6.84dd68","group":"bd5a1d91.586a88","order":4,"width":"2","height":"1","name":"Celular","label":"","format":"{{msg.payload}}","layout":"row-center","x":700,"y":700,"wires":[]},{"id":"5087505c.97a35","type":"ui_text","z":"f1b5c0e6.84dd68","group":"9e57a1d8.021468","order":13,"width":2,"height":1,"name":"Ape Status Umid","label":"","format":"{{msg.payload}}","layout":"row-center","x":730,"y":620,"wires":[]},{"id":"d41636b4.701fc8","type":"mqtt in","z":"f1b5c0e6.84dd68","name":"","topic":"ape/quartom2","qos":"1","datatype":"auto","broker":"25167bbc.e1295c","x":230,"y":600,"wires":[["292bd2d6.846726","e30c88ca.518b4"]]},{"id":"a19edd40.647b2","type":"link in","z":"f1b5c0e6.84dd68","name":"input 5 min","links":["753e508a.6a4198"],"x":220,"y":560,"wires":[["e30c88ca.518b4"]],"l":true,"info":"5 min\n"},{"id":"32bbb111.c40afe","type":"mqtt out","z":"f1b5c0e6.84dd68","name":"","topic":"ape/quartom2/umidificador/change","qos":"","retain":"","broker":"25167bbc.e1295c","x":1000,"y":660,"wires":[]},{"id":"292bd2d6.846726","type":"debug","z":"f1b5c0e6.84dd68","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":470,"y":580,"wires":[]},{"id":"7363458.25ee13c","type":"mqtt in","z":"f1b5c0e6.84dd68","name":"","topic":"ape/quartom/dht","qos":"1","datatype":"auto","broker":"25167bbc.e1295c","x":220,"y":860,"wires":[["72f06f4f.c6254"]]},{"id":"7047a69a.a356c8","type":"debug","z":"f1b5c0e6.84dd68","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":730,"y":820,"wires":[]},{"id":"f7ba2f88.4ae7d8","type":"ui_button","z":"f1b5c0e6.84dd68","name":"Ape","group":"9e57a1d8.021468","order":12,"width":2,"height":1,"passthru":false,"label":"Umidif","tooltip":"","color":"","bgcolor":"","icon":"fa-plug","payload":"change","payloadType":"str","topic":"","x":690,"y":580,"wires":[["32bbb111.c40afe"]]},{"id":"72f06f4f.c6254","type":"json","z":"f1b5c0e6.84dd68","name":"","property":"payload","action":"","pretty":false,"x":410,"y":860,"wires":[["c5fad21b.880cc","b78e054b.115c5"]]},{"id":"c5fad21b.880cc","type":"debug","z":"f1b5c0e6.84dd68","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":550,"y":820,"wires":[]},{"id":"6b12865.69120f8","type":"mqtt out","z":"f1b5c0e6.84dd68","name":"","topic":"ape/quartom2/umidificador/change","qos":"","retain":"","broker":"25167bbc.e1295c","x":860,"y":860,"wires":[]},{"id":"1baa46f1.ad4aa1","type":"ui_template","z":"f91e3b4.e8602c8","group":"ac46c281.0280d","name":"","order":3,"width":4,"height":4,"format":"<svg width=\"180\" height=\"35\">\n    \n    <circle id=\"circle1\" cx=\"20\" cy=\"20\" r=\"10\"\n            style=\"stroke: none; fill: {{msg.payload.status}}\"/>\n    <text font-size=\"18px\" font-weight=\"bold\" \n            x=\"48\" y=\"25\"  fill=\"white\">{{msg.payload.device || \"new device\"}}</text>\n</svg>\n<table width=180px>\n\n  <tr>\n    <td>IP</td>\n     <td align=\"right\"><B>{{msg.payload.ip}}</B></td>\n  </tr>\n  <tr>\n    <td>UpTime</td>\n    <td align=\"right\"><B>{{msg.payload.up}}</B></td>\n  </tr>\n  <tr>\n    <td>Reset</td>\n    <td align=\"right\"><B>{{msg.payload.reset}}</B></td>\n  </tr>\n    <tr>\n    <td>Versao</td>\n    <td align=\"right\"><B>{{msg.payload.ver}}</B></td>\n  </tr>\n  <tr>\n    <td>UpDate</td>\n    <td align=\"right\"><B>{{msg.payload.date | date:'dd/MM - HH:mm'}}</B></td>\n  </tr>\n</table>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1060,"y":440,"wires":[[]]},{"id":"94da51bb.d43c88","type":"inject","z":"f91e3b4.e8602c8","name":"clear","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1010,"y":520,"wires":[["1baa46f1.ad4aa1"]]},{"id":"1eff0fc7.7cf26","type":"ui_template","z":"f91e3b4.e8602c8","group":"4c24412b.903b68","name":"ape/quartom2","order":3,"width":4,"height":4,"format":"<svg width=\"180\" height=\"35\">\n    \n    <circle id=\"circle1\" cx=\"20\" cy=\"20\" r=\"10\"\n            style=\"stroke: none; fill: {{msg.payload.status}}\"/>\n    <text font-size=\"18px\" font-weight=\"bold\" \n            x=\"48\" y=\"25\"  fill=\"white\">{{msg.payload.device}}</text>\n</svg>\n<table width=180px>\n\n  <tr>\n    <td>IP</td>\n     <td align=\"right\"><B>{{msg.payload.ip}}</B></td>\n  </tr>\n  <tr>\n    <td>UpTime</td>\n    <td align=\"right\"><B>{{msg.payload.up}}</B></td>\n  </tr>\n  <tr>\n    <td>Reset</td>\n    <td align=\"right\"><B>{{msg.payload.reset}}</B></td>\n  </tr>\n    <tr>\n    <td>Versao</td>\n    <td align=\"right\"><B>{{msg.payload.ver}}</B></td>\n  </tr>\n  <tr>\n    <td>UpDate</td>\n    <td align=\"right\"><B>{{msg.payload.date | date:'dd/MM - HH:mm'}}</B></td>\n  </tr>\n</table>\n\n\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1080,"y":240,"wires":[[]]},{"id":"24a62797.64e208","type":"debug","z":"f91e3b4.e8602c8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1530,"y":320,"wires":[]},{"id":"ba813df5.0ced9","type":"comment","z":"f91e3b4.e8602c8","name":"G1","info":"","x":1050,"y":120,"wires":[]},{"id":"db756a51.0cb6c","type":"ui_dropdown","z":"f1b5c0e6.84dd68","name":"","label":"Min","tooltip":"","place":"","group":"9e57a1d8.021468","order":10,"width":2,"height":1,"passthru":true,"options":[{"label":"","value":"40","type":"str"},{"label":"","value":"50","type":"str"},{"label":"","value":"55","type":"str"},{"label":"","value":"60","type":"str"},{"label":"","value":"62","type":"str"}],"payload":"","topic":"minimo","x":410,"y":920,"wires":[["b78e054b.115c5"]]},{"id":"faaee012.5cd87","type":"ui_dropdown","z":"f1b5c0e6.84dd68","name":"","label":"Max","tooltip":"","place":"Select option","group":"9e57a1d8.021468","order":11,"width":2,"height":1,"passthru":true,"options":[{"label":"","value":"80","type":"str"},{"label":"","value":"85","type":"str"},{"label":"","value":"90","type":"str"},{"label":"","value":"68","type":"str"}],"payload":"","topic":"maximo","x":410,"y":980,"wires":[["b78e054b.115c5"]]},{"id":"b78e054b.115c5","type":"function","z":"f1b5c0e6.84dd68","name":"","func":"\nvar v_maximo \nvar v_minimo\nvar v_umidad\n\nv_maximo = (context.get(\"c_maximo\") || 80)\nv_minimo = (context.get(\"c_minimo\") || 40)\nv_umidad = (context.get(\"c_umidad\") || 55)\n\nif(msg.topic === \"minimo\"){\n    context.set(\"c_minimo\", msg.payload)  \n}\n\nif(msg.topic === \"maximo\"){\n    context.set(\"c_maximo\", msg.payload)   \n}\n\nif(msg.payload.u < v_minimo){\n    msg.payload = \"on\"\n    return [msg, null];\n} else {\n    if(msg.payload.u > v_maximo){\n        msg.payload = \"off\"\n        return [msg, null];\n    }\n}\n\n\nif(msg.payload.u < 50){\n    if(msg.payload.u < (v_umidad - 5)){\n        context.set(\"c_umidad\",msg.payload.u)\n        msg.payload = \"Umidade no quarto da Manuela esta em \" +msg.payload.u +\"%\"\n        return[null, null]\n    }\n} else if (msg.payload.u > 60){\n    context.set(\"c_umidad\", 55)\n}\n    ","outputs":2,"noerr":0,"x":570,"y":860,"wires":[["7047a69a.a356c8","6b12865.69120f8"],["a2afefad.be4c68","18b44fc8.49f1c"]]},{"id":"9981f841.5a8c3","type":"mqtt in","z":"f1b5c0e6.84dd68","name":"","topic":"ape/quartom/dht","qos":"1","datatype":"auto","broker":"25167bbc.e1295c","x":160,"y":1320,"wires":[["312b3fca.6cf1c8","7553938b.f321a4"]]},{"id":"312b3fca.6cf1c8","type":"json","z":"f1b5c0e6.84dd68","name":"","property":"payload","action":"","pretty":false,"x":367.8833312988281,"y":1323.8832397460938,"wires":[["b8ddd1b4.a31598","fbfa20e7.a33508","fbe47b4e.b05b48","bb96a5a6.45e648"]]},{"id":"b8ddd1b4.a31598","type":"function","z":"f1b5c0e6.84dd68","name":"","func":"var topico = \"quartom\"     // editar para outro comodo\n\nvar msgU;\nvar msgT;\nvar dateNow = new Date();\n msg.enabled = false;\nif(msg.payload === \"input\") {\n\n    dif_date = (dateNow - context.get('c_time'))/1000/60\n\n\n    if(dif_date >= 6.20){\n\n        msgU = { payload: '-', topic: topico};\n        msgT = { payload: '-', topic: topico};\n    }\n    \n} else {\n\n\nu = msg.payload.u\n    if(msg.payload.u === \"0.00\" && msg.payload.t === \"0.00\"){\n        msgU = { payload: '-', topic: topico};\n        msgT = { payload: '-', topic: topico};\n    } else {\n        msgU = { payload: msg.payload.u, topic: topico};\n        msgT = { payload: msg.payload.t, topic: topico};\n    }\n    context.set(\"c_time\", dateNow)\n\n}\n\nreturn [msgU, msgT]\n","outputs":2,"noerr":0,"x":549.88330078125,"y":1330.8832397460938,"wires":[["84310a43.ca5288"],["8df920bb.6a155","29e27cca.15f9cc","b1c40b29.a818f8"]]},{"id":"24ec5e3a.f9edb2","type":"comment","z":"f1b5c0e6.84dd68","name":"View Celular","info":"locationid/deviceid/mqttAtuadorId/change\n\nape/teste/luz1/change","x":954.63330078125,"y":1327.6834106445312,"wires":[]},{"id":"84310a43.ca5288","type":"ui_text","z":"f1b5c0e6.84dd68","group":"9e57a1d8.021468","order":9,"width":2,"height":1,"name":"","label":"Umidd","format":"{{msg.payload | number:1}} %","layout":"col-center","x":730,"y":1380,"wires":[]},{"id":"8df920bb.6a155","type":"ui_text","z":"f1b5c0e6.84dd68","group":"9e57a1d8.021468","order":8,"width":2,"height":1,"name":"","label":"Temp","format":"{{msg.payload | number:1}} °C ","layout":"col-center","x":728.1166381835938,"y":1416.3944702148438,"wires":[]},{"id":"29e27cca.15f9cc","type":"ui_text","z":"f1b5c0e6.84dd68","group":"a095bd78.a8514","order":8,"width":"2","height":"1","name":"","label":"Temperatura","format":"{{msg.payload | number:1}} °C ","layout":"col-center","x":958.133056640625,"y":1363.2334594726562,"wires":[]},{"id":"b1c40b29.a818f8","type":"debug","z":"f1b5c0e6.84dd68","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":730,"y":1460,"wires":[]},{"id":"7553938b.f321a4","type":"debug","z":"f1b5c0e6.84dd68","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":342.70281982421875,"y":1221.73046875,"wires":[]},{"id":"405e5a61.81fefc","type":"inject","z":"f1b5c0e6.84dd68","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"u\":\"66.00\",\"t\":\"25.90\"}","payloadType":"str","x":134.5,"y":1216,"wires":[["312b3fca.6cf1c8"]]},{"id":"81566d70.4d62c","type":"comment","z":"f1b5c0e6.84dd68","name":"Alterar topico","info":"Alterar variavel topico\n","x":548,"y":1295,"wires":[]},{"id":"b250170.60cfb68","type":"link in","z":"f1b5c0e6.84dd68","name":"input 5 min","links":["753e508a.6a4198"],"x":378.75,"y":1261.75,"wires":[["b8ddd1b4.a31598"]],"l":true,"info":"5 min\n"},{"id":"fbe47b4e.b05b48","type":"function","z":"f1b5c0e6.84dd68","name":"http post data","func":"var sTopico = \"quartom\"     // editar para outro comodo - usado para o grafico\nvar sSensor = \"dht\"\nvar sTemperatura = msg.payload.t\nvar sUmidade = msg.payload.u\n\nif(msg.payload !== \"input\") {\n\n    if(msg.payload.u !== \"0.00\" && msg.payload.t !== \"0.00\"){\n        msg.headers = {'content-type':'application/x-www-form-urlencoded'};\n        msg.payload = { api_key: \"api_key_value\", table:\"Clima\", localidade: sTopico, sensor:sSensor, temperatura: sTemperatura, umidade: sUmidade};\n        return msg\n\n    }\n\n}\n\n \n","outputs":1,"noerr":0,"x":567.1250610351562,"y":1498.875,"wires":[["f964d45.c8456a8"]]},{"id":"f964d45.c8456a8","type":"http request","z":"f1b5c0e6.84dd68","name":"","method":"POST","ret":"txt","paytoqs":false,"url":"http://localhost/post-esp-data.php","tls":"","proxy":"","authType":"","x":757.1250610351562,"y":1498.875,"wires":[["2ab52d41.c16e22"]]},{"id":"2ab52d41.c16e22","type":"debug","z":"f1b5c0e6.84dd68","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":957.1250610351562,"y":1498.875,"wires":[]},{"id":"fbfa20e7.a33508","type":"debug","z":"f1b5c0e6.84dd68","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":542.7028198242188,"y":1201.73046875,"wires":[]},{"id":"aad3b466.a028b","type":"debug","z":"a76391e.e9c7d7","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1120,"y":2120,"wires":[]},{"id":"d60322e6.75efb","type":"debug","z":"a76391e.e9c7d7","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1180,"y":2220,"wires":[]},{"id":"455d3bc8.d443d4","type":"inject","z":"600c7542.809754","name":"","repeat":"","crontab":"","once":false,"onceDelay":"10","topic":"","payload":"","payloadType":"date","x":200,"y":120,"wires":[["6e0244f7.c6c9ac"]]},{"id":"6e0244f7.c6c9ac","type":"function","z":"600c7542.809754","name":"","func":"msg.topic = \"SELECT * FROM Clima where localidade in ('quarto') ORDER BY id DESC LIMIT 10\"\nreturn msg;","outputs":1,"noerr":0,"x":380,"y":100,"wires":[["21d37487.409e24"]]},{"id":"21d37487.409e24","type":"mysql","z":"600c7542.809754","mydb":"ef6bd426.64b96","name":"Clima","x":430,"y":160,"wires":[["3a81c397.f87dec","59e02de7.742474"]]},{"id":"3a81c397.f87dec","type":"debug","z":"600c7542.809754","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":610,"y":100,"wires":[]},{"id":"59e02de7.742474","type":"function","z":"600c7542.809754","name":"","func":"msg.topic=\"'temperatura'\"\n\nvar msgU = { payload: msg.payload[0].umidade, topic: 'umidade'};\nvar msgT = { payload:  msg.payload[0].temperatura, topic: 'temperatura'};\n\nreturn [msgU, msgT]\n\n//2020-04-07T15:46:12.000Z\n\n//moment().format(\"dddd, MMMM Do YYYY, H:mm:ss\")","outputs":2,"noerr":0,"x":620,"y":160,"wires":[["f2f6fcb0.01e548","a3e37201.ef7c5"],["a3e37201.ef7c5","f2f6fcb0.01e548"]]},{"id":"f2f6fcb0.01e548","type":"debug","z":"600c7542.809754","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":860,"y":220,"wires":[]},{"id":"a3e37201.ef7c5","type":"ui_chart","z":"600c7542.809754","name":"","group":"e8af268b.39df78","order":1,"width":8,"height":8,"label":"QuartoSQL2","chartType":"line","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"86400","cutout":0,"useOneColor":false,"colors":["#1f77b4","#d62727","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":860,"y":160,"wires":[[]]},{"id":"5571bccd.b3ba64","type":"inject","z":"600c7542.809754","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"[]","payloadType":"json","x":640,"y":220,"wires":[["a3e37201.ef7c5"]]},{"id":"aa20b683.7e4048","type":"inject","z":"600c7542.809754","name":"","repeat":"","crontab":"","once":false,"onceDelay":"10","topic":"","payload":"","payloadType":"date","x":160,"y":460,"wires":[["ec02f636.c485d8"]]},{"id":"ec02f636.c485d8","type":"function","z":"600c7542.809754","name":"","func":"// msg.topic = \"SELECT * FROM Clima where localidade in ('quarto') ORDER BY id DESC LIMIT 1400\"\nif(msg.topic == \"quantidade\"){\n    context.set(\"c_quantidade\", msg.payload)\n}\n\nif(msg.topic == \"periodo\"){\n    context.set(\"c_periodo\", msg.payload)  \n}\nquantidade = (context.get(\"c_quantidade\") || 1)\nperiodo = (context.get(\"c_periodo\") || \"day\")\n\nselect = \nmsg.topic = \"SELECT * FROM Clima where localidade in ('quarto') and time  >= DATE_SUB(NOW(),INTERVAL \" + quantidade + \" \" +  periodo +\") ORDER BY id\"\nreturn msg;\n\n","outputs":1,"noerr":0,"x":290,"y":460,"wires":[["966c740e.2e00f8","f2aa69cf.6cfa6"]]},{"id":"966c740e.2e00f8","type":"mysql","z":"600c7542.809754","mydb":"ef6bd426.64b96","name":"Clima","x":430,"y":460,"wires":[["84037f44.73f468","a6950cdf.c394d"]]},{"id":"84037f44.73f468","type":"debug","z":"600c7542.809754","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":450,"y":400,"wires":[]},{"id":"d0b0489b.b462f8","type":"ui_chart","z":"600c7542.809754","name":"","group":"e8af268b.39df78","order":6,"width":0,"height":0,"label":"testesql2","chartType":"line","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"100","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#cb0707","#3f62da","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":800,"y":460,"wires":[[]]},{"id":"87373dfb.6794c8","type":"inject","z":"600c7542.809754","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"[]","payloadType":"json","x":570,"y":540,"wires":[["d0b0489b.b462f8"]]},{"id":"a6950cdf.c394d","type":"function","z":"600c7542.809754","name":"","func":"/////////// converdter temperatura em y e time am x\nvar json = msg.payload\n  \njson = JSON.parse(JSON.stringify(json).split('\"temperatura\":').join('\"y\":'));\njson = JSON.parse(JSON.stringify(json).split('\"time\":').join('\"x\":'));\n\n//////////////// fim \nmsgT = json\n\n\n/////////// converdter temperatura em y e time am x\njson = msg.payload\n  \njson = JSON.parse(JSON.stringify(json).split('\"umidade\":').join('\"y\":'));\njson = JSON.parse(JSON.stringify(json).split('\"time\":').join('\"x\":'));\n\n//////////////// fim\nmsgU = json\n\n\nmsg.payload = [\n    {\n\t\t\"series\":[\n\t\t\t\t\"Temperatura\", \"Umidade\"\n\t\t],\n\t\t\"data\":[ \n\t\t\tmsgT, msgU\n\t\t]\n    }\n]\n\n\nreturn msg\n\n","outputs":1,"noerr":0,"x":590,"y":460,"wires":[["d0b0489b.b462f8"]]},{"id":"2b495c98.203f74","type":"ui_dropdown","z":"600c7542.809754","name":"","label":"","tooltip":"","place":"Select option","group":"e8af268b.39df78","order":4,"width":3,"height":1,"passthru":false,"options":[{"label":"hora","value":"hour","type":"str"},{"label":"dia","value":"day","type":"str"}],"payload":"","topic":"periodo","x":220,"y":300,"wires":[["fec76b0c.96775","ec02f636.c485d8"]]},{"id":"fec76b0c.96775","type":"debug","z":"600c7542.809754","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":390,"y":280,"wires":[]},{"id":"f2aa69cf.6cfa6","type":"debug","z":"600c7542.809754","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":470,"y":340,"wires":[]},{"id":"cc76e1a9.62726","type":"ui_numeric","z":"600c7542.809754","name":"","label":"numeric","tooltip":"","group":"e8af268b.39df78","order":2,"width":4,"height":1,"wrap":false,"passthru":true,"topic":"quantidade","format":"{{value}}","min":0,"max":"30","step":1,"x":220,"y":240,"wires":[["ec02f636.c485d8"]]},{"id":"6a0190cb.a888c","type":"inject","z":"600c7542.809754","name":"1D","repeat":"300","crontab":"","once":false,"onceDelay":"10","topic":"","payload":"{\"quantidade\":1,\"periodo\":\"day\"}","payloadType":"json","x":130,"y":780,"wires":[["4bbb0f4d.e25f08","bcd13de5.d45c98","88a34879.eaa36","9caa0733.641e"]]},{"id":"4bbb0f4d.e25f08","type":"function","z":"600c7542.809754","name":"quarto","func":"quantidade = msg.payload.quantidade\nperiodo = msg.payload.periodo\n// quantidade = 1\n// periodo = \"day\"\n\nmsg.location = \"quarto\"\n\nmsg.topic = \"SELECT * FROM Clima WHERE localidade in ('\"+msg.location+\"') and time  >= DATE_SUB(NOW(),INTERVAL \" + quantidade + \" \" +  periodo +\") ORDER BY id\"\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":310,"y":780,"wires":[["56c4783.901d608","7cbfd5df.b2314c"]]},{"id":"56c4783.901d608","type":"mysql","z":"600c7542.809754","mydb":"ef6bd426.64b96","name":"Clima","x":510,"y":780,"wires":[["754e2d71.e4164c","cc01b309.2fb758","9343e84f.5d69b8","85377b1.2720588"]]},{"id":"754e2d71.e4164c","type":"function","z":"600c7542.809754","name":"","func":"/////////// converdter temperatura em y e time am x\nvar json = msg.payload\n  \njson = JSON.parse(JSON.stringify(json).split('\"temperatura\":').join('\"y\":'));\njson = JSON.parse(JSON.stringify(json).split('\"time\":').join('\"x\":'));\n//////////////// fim \n\n\nif(msg.location == \"quarto\"){\n    context.set(\"c_quarto\", json)\n} else if(msg.location == \"teste\"){\n    context.set(\"c_teste\", json)\n} else if(msg.location == \"externo\"){\n    context.set(\"c_externo\", json)\n} else if(msg.location == \"quartom\"){\n    context.set(\"c_quartom\", json)\n} \n\nc_quarto = context.get(\"c_quarto\")\nc_teste = context.get(\"c_teste\")\nc_externo = context.get(\"c_externo\")\nc_quartom = context.get(\"c_quartom\")\n\n\nmsg.payload = [\n    {\n\t\t\"series\":[\n\t\t\t\t\"Quarto\", \"Teste\", \"Externo\", \"QuartoM\"\n\t\t],\n\t\t\"data\":[ \n\t\t\tc_quarto, c_teste, c_externo, c_quartom\n\t\t]\n    }\n]\n\n\nreturn msg\n\n","outputs":1,"noerr":0,"x":710,"y":780,"wires":[["8e64ba2c.b3a078"]]},{"id":"bcd13de5.d45c98","type":"function","z":"600c7542.809754","name":"teste","func":"quantidade = msg.payload.quantidade\nperiodo = msg.payload.periodo\n\nmsg.location = \"teste\"\n\nmsg.topic = \"SELECT * FROM Clima WHERE localidade in ('\"+msg.location+\"') and time  >= DATE_SUB(NOW(),INTERVAL \" + quantidade + \" \" +  periodo +\") ORDER BY id\"\n\nreturn msg;\n\n ","outputs":1,"noerr":0,"x":310,"y":820,"wires":[["56c4783.901d608"]]},{"id":"88a34879.eaa36","type":"function","z":"600c7542.809754","name":"externo","func":"quantidade = msg.payload.quantidade\nperiodo = msg.payload.periodo\n\nmsg.location = \"externo\"\n\nmsg.topic = \"SELECT * FROM Clima WHERE localidade in ('\"+msg.location+\"') and time  >= DATE_SUB(NOW(),INTERVAL \" + quantidade + \" \" +  periodo +\") ORDER BY id\"\n\nreturn msg;\n\n ","outputs":1,"noerr":0,"x":320,"y":860,"wires":[["56c4783.901d608"]]},{"id":"cc01b309.2fb758","type":"debug","z":"600c7542.809754","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":590,"y":680,"wires":[]},{"id":"9caa0733.641e","type":"function","z":"600c7542.809754","name":"quartom","func":"quantidade = msg.payload.quantidade\nperiodo = msg.payload.periodo\n\nmsg.location = \"quartom\"\n\nmsg.topic = \"SELECT * FROM Clima WHERE localidade in ('\"+msg.location+\"') and time  >= DATE_SUB(NOW(),INTERVAL \" + quantidade + \" \" +  periodo +\") ORDER BY id\"\n\nreturn msg;\n\n ","outputs":1,"noerr":0,"x":320,"y":900,"wires":[["56c4783.901d608"]]},{"id":"8e64ba2c.b3a078","type":"ui_chart","z":"600c7542.809754","name":"","group":"9e61c410.6a367","order":1,"width":0,"height":0,"label":"Temperatura 1DSQL","chartType":"line","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":"1","removeOlderPoints":"","removeOlderUnit":"86400","cutout":0,"useOneColor":false,"colors":["#1f77b4","#d62727","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":900,"y":780,"wires":[[]]},{"id":"9343e84f.5d69b8","type":"function","z":"600c7542.809754","name":"","func":"/////////// converdter temperatura em y e time am x\nvar json = msg.payload\n  \njson = JSON.parse(JSON.stringify(json).split('\"umidade\":').join('\"y\":'));\njson = JSON.parse(JSON.stringify(json).split('\"time\":').join('\"x\":'));\n//////////////// fim \n\n\nif(msg.location == \"quarto\"){\n    context.set(\"c_quarto\", json)\n} else if(msg.location == \"teste\"){\n    context.set(\"c_teste\", json)\n} else if(msg.location == \"externo\"){\n    context.set(\"c_externo\", json)\n} else if(msg.location == \"quartom\"){\n    context.set(\"c_quartom\", json)\n} \n\nc_quarto = context.get(\"c_quarto\")\nc_teste = context.get(\"c_teste\")\nc_externo = context.get(\"c_externo\")\nc_quartom = context.get(\"c_quartom\")\n\n\nmsg.payload = [\n    {\n\t\t\"series\":[\n\t\t\t\t\"Quarto\", \"Teste\", \"Externo\", \"QuartoM\"\n\t\t],\n\t\t\"data\":[ \n\t\t\tc_quarto, c_teste, c_externo, c_quartom\n\t\t]\n    }\n]\n\n\nreturn msg\n\n","outputs":1,"noerr":0,"x":710,"y":840,"wires":[["1f6175d6.79fb42","1260d06b.e9cd1"]]},{"id":"1f6175d6.79fb42","type":"debug","z":"600c7542.809754","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":950,"y":920,"wires":[]},{"id":"1260d06b.e9cd1","type":"ui_chart","z":"600c7542.809754","name":"","group":"9e61c410.6a367","order":2,"width":0,"height":0,"label":"Umidade 1DSQL","chartType":"line","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":"1","removeOlderPoints":"","removeOlderUnit":"86400","cutout":0,"useOneColor":false,"colors":["#1f77b4","#d62727","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":890,"y":840,"wires":[[]]},{"id":"56a0327c.75fc0c","type":"inject","z":"600c7542.809754","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"[]","payloadType":"json","x":710,"y":940,"wires":[["1260d06b.e9cd1"]]},{"id":"85377b1.2720588","type":"function","z":"600c7542.809754","name":"","func":"/////////// converdter temperatura em y e time am x\nvar json = msg.payload\n  \njson = JSON.parse(JSON.stringify(json).split('\"temperatura\":').join('\"y\":'));\njson = JSON.parse(JSON.stringify(json).split('\"time\":').join('\"x\":'));\n\n//////////////// fim \nmsgT = json\n\n\n/////////// converdter temperatura em y e time am x\njson = msg.payload\n  \njson = JSON.parse(JSON.stringify(json).split('\"umidade\":').join('\"y\":'));\njson = JSON.parse(JSON.stringify(json).split('\"time\":').join('\"x\":'));\n\n//////////////// fim\nmsgU = json\n\n\nmsg.payload = [\n    {\n\t\t\"series\":[\n\t\t\t\t\"Temperatura\", \"Umidade\"\n\t\t],\n\t\t\"data\":[ \n\t\t\tmsgT, msgU\n\t\t]\n    }\n]\n\nif(msg.location == \"quarto\"){\n    return[msg, null, null]\n} else if(msg.location ==\"proto\"){\n    return[null, msg, null]\n} else if(msg.location == \"quartom\"){\n    return[null, null, msg]\n}\n\n","outputs":3,"noerr":0,"x":710,"y":720,"wires":[["53b478e3.734c38","b2f3315e.1de2d"],["6362c9a8.a9f75"],["1e9f4142.71986f"]]},{"id":"1e9f4142.71986f","type":"ui_chart","z":"600c7542.809754","name":"","group":"9e61c410.6a367","order":5,"width":0,"height":0,"label":"QuartoM","chartType":"line","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":"1","removeOlderPoints":"","removeOlderUnit":"86400","cutout":0,"useOneColor":false,"colors":["#d62728","#1f77b4","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":860,"y":740,"wires":[[]]},{"id":"6362c9a8.a9f75","type":"ui_chart","z":"600c7542.809754","name":"","group":"9e61c410.6a367","order":4,"width":0,"height":0,"label":"Proto","chartType":"line","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":"1","removeOlderPoints":"","removeOlderUnit":"86400","cutout":0,"useOneColor":false,"colors":["#d62728","#1f77b4","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":850,"y":700,"wires":[[]]},{"id":"53b478e3.734c38","type":"ui_chart","z":"600c7542.809754","name":"","group":"9e61c410.6a367","order":3,"width":0,"height":0,"label":"Quarto","chartType":"line","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":"1","removeOlderPoints":"","removeOlderUnit":"86400","cutout":0,"useOneColor":false,"colors":["#d62728","#1f77b4","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":860,"y":660,"wires":[[]]},{"id":"a2afefad.be4c68","type":"pushover","z":"f1b5c0e6.84dd68","name":"","device":"","title":"","priority":0,"sound":"","url":"","url_title":"","html":false,"x":720,"y":920,"wires":[]},{"id":"6c2867b2.9ce45","type":"inject","z":"f1b5c0e6.84dd68","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"u\":\"43\",\"t\":\"24.07\"}","payloadType":"str","x":210,"y":940,"wires":[["72f06f4f.c6254"]]},{"id":"f254c6e3.d64f48","type":"debug","z":"f1b5c0e6.84dd68","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":450,"y":700,"wires":[]},{"id":"f41a2b7f.cb75e8","type":"mqtt in","z":"f1b5c0e6.84dd68","name":"","topic":"ape/quartom2/umidificador","qos":"1","datatype":"auto","broker":"25167bbc.e1295c","x":210,"y":700,"wires":[["f254c6e3.d64f48","e30c88ca.518b4"]]},{"id":"8110a01.b1fe66","type":"ui_text","z":"a76391e.e9c7d7","group":"aabedb75.31173","order":4,"width":2,"height":1,"name":"","label":"Umidd","format":"{{msg.payload | number:1}} %","layout":"col-center","x":802.1805419921875,"y":1856.4028930664062,"wires":[]},{"id":"18b44fc8.49f1c","type":"debug","z":"f1b5c0e6.84dd68","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":700,"y":980,"wires":[]},{"id":"f5a1c298.7cd258","type":"function","z":"f1b5c0e6.84dd68","name":"Enable/Disable new","func":"var msg1 = msg\nvar msg2\nvar dateNow = new Date();\nenvia_pushover = context.get('c_envia_pushover')\nvar old_time = context.get('c_time') || 0\n\nif(msg.payload === \"input\") {\n\n    dif_date = (dateNow - old_time)/1000/60\n    if(context.get('c_envia_pushover') === \"sim\"){\n        if(dif_date >= 6.20){\n            msg2 = { payload:\"disconected\"};\n            context.set(\"c_envia_pushover\", \"não\")\n        }\n    }\n\n    return [null, msg2]\n    \n} else {\n\n    if(msg.payload === \"on\"){\n        msg.payload = \"Ligado\"\n        msg.enabled = true\n    } else {\n        if(msg.payload === \"off\"){\n            msg.payload = \"Desligado\"\n            msg.enabled = true\n        } else {\n            if(msg.payload === \"disconnect\"){\n                msg.payload = \"Off Line\"\n                msg.enabled = false\n                context.set(\"c_time\", dateNow)\n                context.set(\"c_envia_pushover\", \"sim\")\n            }\n            \n        }\n    }\n}\n\nreturn [msg1, null]\n\n","outputs":2,"noerr":0,"x":440,"y":1760,"wires":[["411da196.727f7","760cb57c.7ef1f4","883a5dad.fe4ad","ae035048.176068"],[]]},{"id":"411da196.727f7","type":"ui_button","z":"f1b5c0e6.84dd68","name":"Celular","group":"bd5a1d91.586a88","order":2,"width":"2","height":"1","passthru":false,"label":"Umidificador","tooltip":"","color":"","bgcolor":"","icon":"wb_incandescent","payload":"change","payloadType":"str","topic":"","x":660,"y":1780,"wires":[["57eac01d.dc0788"]]},{"id":"760cb57c.7ef1f4","type":"ui_text","z":"f1b5c0e6.84dd68","group":"bd5a1d91.586a88","order":5,"width":"2","height":"1","name":"Celular","label":"","format":"{{msg.payload}}","layout":"row-center","x":660,"y":1820,"wires":[]},{"id":"883a5dad.fe4ad","type":"ui_text","z":"f1b5c0e6.84dd68","group":"7ac0c575.b52f2c","order":4,"width":2,"height":1,"name":"Ape Status Umid","label":"","format":"{{msg.payload}}","layout":"row-center","x":690,"y":1740,"wires":[]},{"id":"50d0cb51.9be564","type":"mqtt in","z":"f1b5c0e6.84dd68","name":"","topic":"ape/sala","qos":"1","datatype":"auto","broker":"25167bbc.e1295c","x":180,"y":1720,"wires":[["ef0d3fec.5d5d8","f5a1c298.7cd258"]]},{"id":"f0dd5d15.9f4f18","type":"link in","z":"f1b5c0e6.84dd68","name":"input 5 min","links":["753e508a.6a4198"],"x":180,"y":1680,"wires":[["f5a1c298.7cd258"]],"l":true,"info":"5 min\n"},{"id":"57eac01d.dc0788","type":"mqtt out","z":"f1b5c0e6.84dd68","name":"","topic":"ape/sala/estar/change","qos":"","retain":"","broker":"25167bbc.e1295c","x":920,"y":1780,"wires":[]},{"id":"ef0d3fec.5d5d8","type":"debug","z":"f1b5c0e6.84dd68","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":430,"y":1700,"wires":[]},{"id":"ae035048.176068","type":"ui_button","z":"f1b5c0e6.84dd68","name":"Estar","group":"7ac0c575.b52f2c","order":3,"width":2,"height":1,"passthru":false,"label":"Estar","tooltip":"","color":"","bgcolor":"","icon":"wb_incandescent","payload":"change","payloadType":"str","topic":"","x":650,"y":1700,"wires":[["57eac01d.dc0788"]]},{"id":"b2e315fe.3c48a8","type":"debug","z":"f1b5c0e6.84dd68","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":410,"y":1820,"wires":[]},{"id":"1fbbff08.017c69","type":"mqtt in","z":"f1b5c0e6.84dd68","name":"","topic":"ape/sala/estar","qos":"1","datatype":"auto","broker":"25167bbc.e1295c","x":150,"y":1820,"wires":[["b2e315fe.3c48a8","f5a1c298.7cd258"]]},{"id":"53a45687.66ec88","type":"function","z":"f1b5c0e6.84dd68","name":"Enable/Disable new","func":"var msg1 = msg\nvar msg2\nvar dateNow = new Date();\nenvia_pushover = context.get('c_envia_pushover')\nvar old_time = context.get('c_time') || 0\n\nif(msg.payload === \"input\") {\n\n    dif_date = (dateNow - old_time)/1000/60\n    if(context.get('c_envia_pushover') === \"sim\"){\n        if(dif_date >= 6.20){\n            msg2 = { payload:\"disconected\"};\n            context.set(\"c_envia_pushover\", \"não\")\n        }\n    }\n\n    return [null, msg2]\n    \n} else {\n\n    if(msg.payload === \"on\"){\n        msg.payload = \"Ligado\"\n        msg.enabled = true\n    } else {\n        if(msg.payload === \"off\"){\n            msg.payload = \"Desligado\"\n            msg.enabled = true\n        } else {\n            if(msg.payload === \"disconnect\"){\n                msg.payload = \"Off Line\"\n                msg.enabled = false\n                context.set(\"c_time\", dateNow)\n                context.set(\"c_envia_pushover\", \"sim\")\n            }\n            \n        }\n    }\n}\n\nreturn [msg1, null]\n\n","outputs":2,"noerr":0,"x":400,"y":2060,"wires":[["6f654309.cc57a4","bcf455de.87bd78","d22b8276.29aec","8451e0d0.1e2b48"],[]]},{"id":"1860aa5.43523d6","type":"mqtt in","z":"f1b5c0e6.84dd68","name":"","topic":"ape/sala","qos":"1","datatype":"auto","broker":"25167bbc.e1295c","x":140,"y":2020,"wires":[["bfe12f02.73dd1","53a45687.66ec88"]]},{"id":"6f654309.cc57a4","type":"ui_button","z":"f1b5c0e6.84dd68","name":"Celular","group":"bd5a1d91.586a88","order":3,"width":"2","height":"1","passthru":false,"label":"Umidificador","tooltip":"","color":"","bgcolor":"","icon":"wb_incandescent","payload":"change","payloadType":"str","topic":"","x":620,"y":2080,"wires":[["311d7dc6.c457d2"]]},{"id":"bcf455de.87bd78","type":"ui_text","z":"f1b5c0e6.84dd68","group":"bd5a1d91.586a88","order":6,"width":"2","height":"1","name":"Celular","label":"","format":"{{msg.payload}}","layout":"row-center","x":620,"y":2120,"wires":[]},{"id":"d22b8276.29aec","type":"ui_text","z":"f1b5c0e6.84dd68","group":"7ac0c575.b52f2c","order":8,"width":2,"height":1,"name":"Ape Status Umid","label":"","format":"{{msg.payload}}","layout":"row-center","x":650,"y":2040,"wires":[]},{"id":"8451e0d0.1e2b48","type":"ui_button","z":"f1b5c0e6.84dd68","name":"Indireta","group":"7ac0c575.b52f2c","order":7,"width":2,"height":1,"passthru":false,"label":"Indireta","tooltip":"","color":"","bgcolor":"","icon":"wb_incandescent","payload":"change","payloadType":"str","topic":"","x":620,"y":2000,"wires":[["311d7dc6.c457d2"]]},{"id":"6da78554.5e2684","type":"link in","z":"f1b5c0e6.84dd68","name":"input 5 min","links":["753e508a.6a4198"],"x":140,"y":1980,"wires":[["53a45687.66ec88"]],"l":true,"info":"5 min\n"},{"id":"4452398c.98adf8","type":"mqtt in","z":"f1b5c0e6.84dd68","name":"","topic":"ape/sala/indireta","qos":"1","datatype":"auto","broker":"25167bbc.e1295c","x":120,"y":2120,"wires":[["f0656d76.50e508","53a45687.66ec88","4f10cbe2.daa894"]]},{"id":"bfe12f02.73dd1","type":"debug","z":"f1b5c0e6.84dd68","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":390,"y":2000,"wires":[]},{"id":"311d7dc6.c457d2","type":"mqtt out","z":"f1b5c0e6.84dd68","name":"","topic":"ape/sala/indireta/change","qos":"","retain":"","broker":"25167bbc.e1295c","x":890,"y":2080,"wires":[]},{"id":"f0656d76.50e508","type":"debug","z":"f1b5c0e6.84dd68","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":150,"y":2200,"wires":[]},{"id":"4f10cbe2.daa894","type":"function","z":"f1b5c0e6.84dd68","name":"tempo aceso + http request","func":"var sLocalidade //= msg.topic.split('/')[1];   \nif(msg.topic.split('/')[1] === \"luz\"){\n    sLocalidade = msg.topic.split('/')[1];\n} else {\n    sLocalidade = msg.topic.split('/')[2];\n}\n\nvar now = new Date();   // current time\nvar time_on = context.get(\"time_on\") || 0 \nvar tempo_ligado = 0\nvar tempo_ligado2 = 0\nvar dia2 = 0\nvar dia = 0\n\n\n\nif (msg.payload == \"on\"){\n    if(time_on === 0){\n        context.set(\"time_on\", now)\n        node.warn(\"iniciou coleta tempo \" + now);\n    }\n} else if (msg.payload == \"off\"){\n\n    context.set(\"time_on\", 0)\n\n\n    start = time_on\n    Start_day =\t\tstart.getDate()\n    Start_month =\tstart.getMonth() + 1\n    Start_year =\tstart.getFullYear()\n    Start_hours =\tstart.getHours()\n    Start_mins =\tstart.getMinutes()\n\n    Fim_day =\tnow.getDate()\n    Fim_month =\tnow.getMonth() + 1\n    Fim_year =\tnow.getFullYear()\n    Fim_hours =\tnow.getHours()\n    Fim_mins =\tnow.getMinutes()\n\n    // node.warn(\"finalizou coleta tempo\\ninicio = \" + time_on + \"\\nfinal =  \" + now );\n    \n    // // ######################\n    // Start_day =\t\t13\n    // Start_hours =\t23\n    // Start_mins =\t55\n    \n    // // ######################\n\n        \n  \n    if ((Fim_day > Start_day) || (Fim_month > Start_month) || (Fim_year > Start_year)){\n        \n        tempo_ligado  = Math.round(1440 -  ((Start_hours * 60) + Start_mins))\n        tempo_ligado2 = Math.round((Fim_hours * 60) + Fim_mins)\n        \n        dia  = Start_year +\"-\"+ Start_month +\"-\"+ Start_day\n        dia2 = (Fim_year +\"-\"+ Fim_month +\"-\"+ Fim_day || 0)\n\n\n// #################### pacote http request ####################\n        msg.headers = {'content-type':'application/x-www-form-urlencoded'};\n        msg.payload = { api_key: \"api_key_value\",\n                        table:\"TempoLuz\",\n                        localidade: sLocalidade,\n                        data:dia,\n                        tempoligado: tempo_ligado\n                      };\n\n        msg2 =  {\n                headers :{'content-type':'application/x-www-form-urlencoded'},\n                payload :{  api_key: \"api_key_value\",\n                            table:\"TempoLuz\",\n                            localidade: sLocalidade,\n                            data:dia2,\n                            tempoligado: tempo_ligado2}\n            \n                }\n// #################### fim pacote http request #################\n        return [msg, msg2]\n    } else {\n        tempo_ligado = Math.round((now - time_on)/1000/60)\n        msg.tempo_ligado = tempo_ligado\n        msg.dia = Start_year +\"-\"+ Start_month +\"-\"+ Start_day\n        \n        \n// #################### pacote http request ####################\n\n        msg.headers = {'content-type':'application/x-www-form-urlencoded'};\n        msg.payload = { api_key: \"api_key_value\",\n                        table:\"TempoLuz\",\n                        localidade: sLocalidade,\n                        data:dia,\n                        tempoligado: tempo_ligado\n                      };\n// #################### fim pacote http request #################\n\n        return [msg, null]\n    }\n    \n\n}\n\n\n\n","outputs":2,"noerr":0,"x":420,"y":2180,"wires":[["b111075b.b3de68","24917771.b59f3"],["49b61bdc.db1a6c","24917771.b59f3"]],"info":"if ( !msg.timestamp ) msg.timestamp = Math.round(+new Date());\n\nvar dt = new Date(msg.timestamp);\nvar msg = {\n\t'month':\tdt.getMonth() + 1,\n\t'day':\t\tdt.getDate(),\n\t'year':\t\tdt.getFullYear(),\n\t'hours':\tdt.getHours(),\n\t'mins':\t\tdt.getMinutes(),\n\t'msecs':\tdt.getMilliseconds()\n}\n\nreturn msg;"},{"id":"b111075b.b3de68","type":"http request","z":"f1b5c0e6.84dd68","name":"","method":"POST","ret":"txt","paytoqs":false,"url":"http://localhost/post-esp-data.php","tls":"","proxy":"","authType":"","x":750,"y":2180,"wires":[["af231a0.98e95e8"]]},{"id":"84cf7220.b49b6","type":"debug","z":"a76391e.e9c7d7","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":660,"y":660,"wires":[]},{"id":"9ec6d3db.a5e508","type":"debug","z":"a76391e.e9c7d7","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":390,"y":3000,"wires":[]},{"id":"732ad58e.5af54c","type":"inject","z":"f1b5c0e6.84dd68","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"ape/sala/indireta","payload":"on","payloadType":"str","x":130,"y":2280,"wires":[["4f10cbe2.daa894"]]},{"id":"afaa43ab.26853","type":"inject","z":"f1b5c0e6.84dd68","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"ape/sala/indireta","payload":"off","payloadType":"str","x":130,"y":2320,"wires":[["4f10cbe2.daa894"]]},{"id":"af231a0.98e95e8","type":"debug","z":"f1b5c0e6.84dd68","name":"http","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":910,"y":2180,"wires":[]},{"id":"49b61bdc.db1a6c","type":"delay","z":"f1b5c0e6.84dd68","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":620,"y":2220,"wires":[["b111075b.b3de68"]]},{"id":"efaf8952.3b5058","type":"function","z":"f91e3b4.e8602c8","name":"Calculo tempo desconectado","func":"var now = new Date();   // current time\nvar count = context.get('f_count')||0;\n\n// ###################################\nvar time_old = context.get(\"f_time_old\")\n\nif(msg.topic === \"set_time\"){\n    context.set(\"f_time_old\", now)\n}\n\n// ##################################\nfor (var x = 0; x <= count; x++){\n    if(count === x){\n        context.set(\"f_device[\"+x+\"]\" ,msg.payload.device)\n        count++\n        context.set(\"f_count\", count)\n        device_id_num = x\n        break; \n    }\n\n    if (context.get(\"f_device[\"+x+\"]\") === msg.payload.device){\n        device_id_num = x\n        break; \n    }\n\n}\n\nvar time_off = context.get(\"time_off[\"+device_id_num+\"]\") || 0 \n\nif (msg.payload.status === \"red\"){\n    if(time_off === 0){\n        context.set(\"time_off[\"+device_id_num+\"]\", now)\n        \n        // ####################333\n        context.set(\"time_off[\"+device_id_num+\"]\", time_old)\n        // ####################333\n        \n        \n        node.warn(\"iniciou coleta tempo desconectado para device \" + msg.payload.device + \" as \" + now);\n    }\n} else if (msg.payload.status === \"green\"){\n    \n    if(time_off !== 0){\n\n\n        start = time_off\n        Start_day =\t\tstart.getDate()\n        Start_month =\tstart.getMonth() + 1\n        Start_year =\tstart.getFullYear()\n        Start_hours =\tstart.getHours()\n        Start_mins =\tstart.getMinutes()\n\n        Fim_day =\tnow.getDate()\n        Fim_month =\tnow.getMonth() + 1\n        Fim_year =\tnow.getFullYear()\n        Fim_hours =\tnow.getHours()\n        Fim_mins =\tnow.getMinutes()\n\n///#####################\n        Fim_hours = 11\n///#####################\n\n        node.warn(\"finalizou coleta tempo device \" +msg.payload.device+\"\\ndesconexão = \" + context.get(\"time_off[\"+device_id_num+\"]\") + \"\\nconexão =  \" + now );\n    \n        msg.tempo_desconectado = Math.round((now - context.get(\"time_off[\"+device_id_num+\"]\"))/1000/60)\n        msg.dia = Start_year +\"-\"+ Start_month +\"-\"+ Start_day\n    \n        context.set(\"time_off[\"+device_id_num+\"]\", 0)\n\n        return msg\n            \n        \n    }\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":580,"y":600,"wires":[["5a0728b9.c162f8","4e66ade8.8046ac"]],"info":"if ( !msg.timestamp ) msg.timestamp = Math.round(+new Date());\n\nvar dt = new Date(msg.timestamp);\nvar msg = {\n\t'month':\tdt.getMonth() + 1,\n\t'day':\t\tdt.getDate(),\n\t'year':\t\tdt.getFullYear(),\n\t'hours':\tdt.getHours(),\n\t'mins':\t\tdt.getMinutes(),\n\t'msecs':\tdt.getMilliseconds()\n}\n\nreturn msg;"},{"id":"5a0728b9.c162f8","type":"function","z":"f91e3b4.e8602c8","name":"http post data","func":"var sLocalidade = msg.payload.device\nvar sTempoDesconectado = msg.tempo_desconectado\n\n\n\nmsg.headers = {'content-type':'application/x-www-form-urlencoded'};\nmsg.payload = { api_key: \"api_key_value\", table:\"TempoDesconectado\", localidade: sLocalidade, tempodesconectado: sTempoDesconectado};\nreturn msg\n\n\n\n \n","outputs":1,"noerr":0,"x":820,"y":600,"wires":[["114ffbda.53e4d4"]]},{"id":"114ffbda.53e4d4","type":"http request","z":"f91e3b4.e8602c8","name":"","method":"POST","ret":"txt","paytoqs":false,"url":"http://localhost/post-esp-data.php","tls":"","proxy":"","authType":"","x":990,"y":600,"wires":[[]]},{"id":"4e66ade8.8046ac","type":"debug","z":"f91e3b4.e8602c8","name":"Status_json","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":810,"y":660,"wires":[]},{"id":"ccf63f7d.314678","type":"inject","z":"f91e3b4.e8602c8","name":"set_time","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"set_time","payload":"{\"device\":\"ape/teste\",\"status\":\"red\"}","payloadType":"str","x":460,"y":660,"wires":[["efaf8952.3b5058"]]},{"id":"249405b.98eb3fa","type":"inject","z":"f91e3b4.e8602c8","name":"red-quartom","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"ape/status","payload":"{\"device\":\"ape/quartom1\",\"status\":\"red\"}","payloadType":"str","x":170,"y":280,"wires":[["aa35ca26.8fc3f8"]]},{"id":"b4f96446.cb08c8","type":"debug","z":"a76391e.e9c7d7","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":450,"y":2880,"wires":[]},{"id":"7da52f9f.c1c958","type":"ui_button","z":"f91e3b4.e8602c8","name":"Clear","group":"ac46c281.0280d","order":4,"width":4,"height":1,"passthru":false,"label":"Clear","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":930,"y":480,"wires":[["1baa46f1.ad4aa1"]]},{"id":"b212ac10.66a438","type":"inject","z":"f91e3b4.e8602c8","name":"red-quartom","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"ape/status","payload":"{\"ip\":\"192.168.15.46\",\"device\":\"ape/sala123\",\"up\":\"0d 00:00\",\"reset\":\"68\",\"ver\":\"3.5.7D5\",\"status\":\"green\"}","payloadType":"str","x":190,"y":220,"wires":[["aa35ca26.8fc3f8"]]},{"id":"b2f3315e.1de2d","type":"debug","z":"600c7542.809754","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":900,"y":600,"wires":[]},{"id":"3e050a2d.480a9e","type":"debug","z":"9271b3dc.6bcd3","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":820,"y":300,"wires":[]},{"id":"b090add.642d95","type":"debug","z":"9271b3dc.6bcd3","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1100,"y":240,"wires":[]},{"id":"7cbfd5df.b2314c","type":"debug","z":"600c7542.809754","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":450,"y":640,"wires":[]},{"id":"24917771.b59f3","type":"debug","z":"f1b5c0e6.84dd68","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":630,"y":2320,"wires":[]},{"id":"23f5538e.5a520c","type":"debug","z":"b5a5d7d1.da846","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"tetra","targetType":"msg","x":940,"y":1700,"wires":[]},{"id":"790c6935.1632c8","type":"mqtt in","z":"b5a5d7d1.da846","name":"","topic":"newdevice/atuador9","qos":"2","datatype":"auto","broker":"25167bbc.e1295c","x":430,"y":1740,"wires":[["a0ec3698.892fd8","2b8ea0f9.1bb72"]]},{"id":"a0ec3698.892fd8","type":"function","z":"b5a5d7d1.da846","name":"","func":"if(msg.payload < 50){\n    // msg.payload = \"aberta\"\n    msg.tetra = \"Aberta\"\n    msg.trinco = \"Aberta\"\n} else if(msg.payload < 600){\n    // msg.payload = \"porta\"\n    msg.tetra = \"Aberta\"\n    msg.trinco = \"Trancada\"\n} else if(msg.payload < 900){\n    // msg.payload = \"tetra\"\n    msg.tetra = \"Trancada\"\n    msg.trinco = \"Aberta\"\n} else {\n    // msg.payload = \"ambas\"\n    msg.tetra = \"Trancada\"\n    msg.trinco = \"Trancada\"\n}\nreturn msg;\n\n\n\n","outputs":1,"noerr":0,"x":730,"y":1740,"wires":[["23f5538e.5a520c","23fb07b6.f35d88","17f8914.ea776ef","a4683879.2d1f18"]]},{"id":"3e2025ca.92664a","type":"ui_template","z":"8f06c833.ed4578","group":"9e57a1d8.021468","name":"Quarto","order":1,"width":0,"height":0,"format":"<style>\ndiv.a {\n text-align: left;\n  margin: center; \n  color:#0eb8c0;\n  font-size: 20px;\n}\n</style>\n<div class=\"a\">\nQuarto\n</div>\n\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":500,"y":100,"wires":[[]]},{"id":"7b592e93.e7a128","type":"ui_template","z":"8f06c833.ed4578","group":"9e57a1d8.021468","name":"Quarto Manu","order":7,"width":0,"height":0,"format":"<style>\ndiv.a {\n/*  text-align: right;\n  margin: center; */ \n  color:#0eb8c0;\n  font-size: 20px;\n}\n</style>\n<div class=\"a\">\nQuarto Manu\n</div>\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":510,"y":180,"wires":[[]]},{"id":"23fb07b6.f35d88","type":"ui_text","z":"b5a5d7d1.da846","group":"7ac0c575.b52f2c","order":9,"width":2,"height":1,"name":"","label":"   <B>   Tetra</B>","format":"{{msg.tetra}}","layout":"col-center","x":840,"y":1840,"wires":[]},{"id":"f1dc5864.03a5d","type":"inject","z":"b5a5d7d1.da846","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"846","payloadType":"num","x":470,"y":1660,"wires":[["a0ec3698.892fd8"]]},{"id":"17f8914.ea776ef","type":"ui_text","z":"b5a5d7d1.da846","group":"7ac0c575.b52f2c","order":10,"width":2,"height":1,"name":"","label":"Trinco","format":"{{msg.trinco}}","layout":"col-center","x":810,"y":1880,"wires":[]},{"id":"a4683879.2d1f18","type":"debug","z":"b5a5d7d1.da846","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"trinco","targetType":"msg","x":950,"y":1740,"wires":[]},{"id":"58f93210.3be5d4","type":"inject","z":"f1b5c0e6.84dd68","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"u\":\"54\",\"t\":\"22.07\"}","payloadType":"str","x":230,"y":800,"wires":[["72f06f4f.c6254"]]},{"id":"bb96a5a6.45e648","type":"function","z":"f1b5c0e6.84dd68","name":"Pushover","func":"v_umidad = (context.get(\"c_umidad\") || 55)\n\nif(msg.payload.u < 50){\n    if(msg.payload.u < (v_umidad - 3)){\n        context.set(\"c_umidad\",msg.payload.u)\n        msg.payload = \"Umidade no quarto da Manuela esta em \" +msg.payload.u +\"%\"\n        return msg\n    }\n} else if (msg.payload.u > 60){\n    context.set(\"c_umidad\", 55)\n}\n    ","outputs":1,"noerr":0,"x":220,"y":1460,"wires":[["4bc8a3ae.5ef9a4","32ada325.e6e304"]]},{"id":"4bc8a3ae.5ef9a4","type":"pushover","z":"f1b5c0e6.84dd68","name":"","device":"","title":"","priority":0,"sound":"","url":"","url_title":"","html":false,"x":380,"y":1460,"wires":[]},{"id":"32ada325.e6e304","type":"debug","z":"f1b5c0e6.84dd68","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":370,"y":1520,"wires":[]},{"id":"5d6207c6.46697","type":"debug","z":"a76391e.e9c7d7","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":770,"y":3380,"wires":[]},{"id":"df983494.a8eee8","type":"debug","z":"a76391e.e9c7d7","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":770,"y":3520,"wires":[]},{"id":"96c9bc07.879c9","type":"debug","z":"a76391e.e9c7d7","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1010,"y":3380,"wires":[]},{"id":"46f08fa2.4ad9c","type":"debug","z":"9271b3dc.6bcd3","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":690,"y":180,"wires":[]},{"id":"661416c5.60dae8","type":"debug","z":"9271b3dc.6bcd3","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":710,"y":420,"wires":[]},{"id":"144c5e1d.62f132","type":"template","z":"f1b5c0e6.84dd68","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"This is the payload: {{payload}} !","output":"str","x":290,"y":420,"wires":[["760ddde.4a95524"]]},{"id":"cc03e65c.c37408","type":"inject","z":"f1b5c0e6.84dd68","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":110,"y":440,"wires":[["144c5e1d.62f132"]]},{"id":"760ddde.4a95524","type":"debug","z":"f1b5c0e6.84dd68","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":480,"y":440,"wires":[]},{"id":"2b8ea0f9.1bb72","type":"debug","z":"b5a5d7d1.da846","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":700,"y":1660,"wires":[]},{"id":"8b62d3f6.cb5b5","type":"debug","z":"a76391e.e9c7d7","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":720,"y":3000,"wires":[]},{"id":"77650db1.734914","type":"debug","z":"a76391e.e9c7d7","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":970,"y":3220,"wires":[]},{"id":"510d0baf.d87994","type":"mqtt in","z":"b5a5d7d1.da846","name":"","topic":"$SYS/brokers/emqx@127.0.0.1/version","qos":"2","datatype":"auto","broker":"25167bbc.e1295c","x":470,"y":2000,"wires":[["21dc7ea6.ff0162"]]},{"id":"21dc7ea6.ff0162","type":"debug","z":"b5a5d7d1.da846","name":"teste_brokers","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":800,"y":2000,"wires":[]},{"id":"8b499d39.36f94","type":"mqtt in","z":"b5a5d7d1.da846","name":"","topic":"$SYS/brokers/emqx@127.0.0.1/#","qos":"2","datatype":"auto","broker":"25167bbc.e1295c","x":430,"y":2100,"wires":[["d2ff13eb.0447e"]]},{"id":"d2ff13eb.0447e","type":"debug","z":"b5a5d7d1.da846","name":"teste_brokers2","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":700,"y":2100,"wires":[]},{"id":"d0aba60d.fae9c8","type":"debug","z":"9271b3dc.6bcd3","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":650,"y":720,"wires":[]},{"id":"beb318b7.daf318","type":"ui_date_picker","z":"f1b5c0e6.84dd68","name":"","label":"date","group":"9e57a1d8.021468","order":13,"width":0,"height":0,"passthru":true,"topic":"","x":300,"y":1040,"wires":[[]]},{"id":"b0531ca1.0de44","type":"inject","z":"a76391e.e9c7d7","d":true,"name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"60","crontab":"","once":false,"onceDelay":0.1,"topic":"ape/corredor/luz/change","payload":"off","payloadType":"str","x":550,"y":2620,"wires":[["6880fcaa.ff4624","ed52e469.ce1b88"]]},{"id":"6880fcaa.ff4624","type":"mqtt out","z":"a76391e.e9c7d7","name":"","topic":"","qos":"","retain":"","broker":"25167bbc.e1295c","x":970,"y":2640,"wires":[]},{"id":"ed52e469.ce1b88","type":"debug","z":"a76391e.e9c7d7","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":970,"y":2700,"wires":[]},{"id":"1350c5d5.ab204a","type":"function","z":"a76391e.e9c7d7","name":"teste lampada","func":"var now = new Date()\n\nhours =\tnow.getHours()\nmins =\tnow.getMinutes()\n\n// sun_rise = get.global(\"g_sun_rise\")\nsun_rise = \"10:20:00\"\nsun_rise_hour = sun_rise.split(\":\")[0]\nsun_rise_mins = sun_rise.split(\":\")[1]\n\ndesl_mins = mins// + 30\ndesl_hours = hours\n\n// vefifica se a soma de minutos passou de 60, considerando que mudou de hora\nif (desl_mins >= 60){\n    desl_mins -= 60\n    desl_hours +=1\n}\n\n\nmsg.sun_rise = sun_rise\nmsg.desliga = desl_hours.toString().padStart(2,\"0\") + \":\" + desl_mins.toString().padStart(2,\"0\")\n\n\nif(msg.topic === automatic_switch){\n    msg.switch = msg.payload\n    flow.set(\"f_switch_status\", \"msg.payload\")\n    return [msg, null]\n}\n\nif(desl_mins >= sun_rise_mins){\n    if(desl_hours === desl_hours){\n        msg.enviada = \"envia desliga\"\n        msg2 = {payload: \"change\"}\n       \n        return [msg, msg2]\n    }\n}\n\n\nreturn [msg, null]\n\n","outputs":2,"noerr":0,"initialize":"","finalize":"","x":1200,"y":2760,"wires":[["7399ed3d.fc9794"],["220285b.e1e1a7a","2fa64e5f.05d672"]]},{"id":"3f4fbe65.de5042","type":"inject","z":"a76391e.e9c7d7","d":true,"name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"120","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1000,"y":2760,"wires":[["1350c5d5.ab204a"]]},{"id":"df53f19e.18037","type":"debug","z":"9271b3dc.6bcd3","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1020,"y":300,"wires":[]},{"id":"7399ed3d.fc9794","type":"debug","z":"a76391e.e9c7d7","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1430,"y":2660,"wires":[]},{"id":"71a9f648.d557b8","type":"ui_text","z":"a76391e.e9c7d7","group":"1b42a45b.1ebb5c","order":0,"width":0,"height":0,"name":"","label":"padded","format":"{{(\"000\"+msg.payload.toString()).slice(-5)}}","layout":"row-spread","x":1540,"y":2980,"wires":[]},{"id":"a6cd5533.b1bc38","type":"inject","z":"a76391e.e9c7d7","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"27","payloadType":"num","x":1323,"y":2978,"wires":[["71a9f648.d557b8"]]},{"id":"e4a5de67.9d872","type":"inject","z":"a76391e.e9c7d7","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"10","payloadType":"num","x":1324.5,"y":3050,"wires":[["71a9f648.d557b8"]]},{"id":"a1a46fbb.b94fa","type":"mqtt out","z":"a76391e.e9c7d7","name":"","topic":"ape/corredor/luz/change","qos":"","retain":"","broker":"25167bbc.e1295c","x":1490,"y":2780,"wires":[]},{"id":"220285b.e1e1a7a","type":"debug","z":"a76391e.e9c7d7","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1430,"y":2720,"wires":[]},{"id":"2fa64e5f.05d672","type":"mqtt out","z":"a76391e.e9c7d7","name":"","topic":"ape/sala/indireta/change","qos":"0","retain":"","broker":"25167bbc.e1295c","x":1490,"y":2820,"wires":[]},{"id":"1a9d808.a22308","type":"debug","z":"a76391e.e9c7d7","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1140,"y":2880,"wires":[]},{"id":"f6d76321.b21d7","type":"ui_switch","z":"a76391e.e9c7d7","name":"","label":"switch","tooltip":"","group":"9e57a1d8.021468","order":14,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"automatic_switch","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":1190,"y":2680,"wires":[["7399ed3d.fc9794","1350c5d5.ab204a"]]}]